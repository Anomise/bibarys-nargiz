<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–µ—Ä–¥—Ü–µ –°–∞—Ç–ø–∞–µ–≤–∞ - –í–∏–∑—É–∞–ª—å–Ω–∞—è –ù–æ–≤–µ–ª–ª–∞</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&family=Caveat:wght@700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background: #0a0a0f;
            color: #fff;
            overflow: hidden;
            height: 100vh;
            width: 100vw;
        }

        /* Platform Selection */
        #platform-select {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .platform-title {
            font-family: 'Caveat', cursive;
            font-size: 4rem;
            color: #ff6b9d;
            text-shadow: 0 0 30px rgba(255, 107, 157, 0.5);
            margin-bottom: 10px;
            animation: glow 2s ease-in-out infinite alternate;
        }

        .platform-version {
            font-size: 1rem;
            color: #74b9ff;
            margin-bottom: 10px;
        }

        @keyframes glow {
            from { text-shadow: 0 0 30px rgba(255, 107, 157, 0.5); }
            to { text-shadow: 0 0 50px rgba(255, 107, 157, 0.8), 0 0 80px rgba(255, 107, 157, 0.4); }
        }

        .platform-subtitle {
            font-size: 1.2rem;
            color: #a0a0a0;
            margin-bottom: 50px;
            text-align: center;
        }

        .platform-buttons {
            display: flex;
            gap: 40px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .platform-btn {
            width: 200px;
            height: 250px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 107, 157, 0.3);
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 20px;
        }

        .platform-btn:hover {
            background: rgba(255, 107, 157, 0.1);
            border-color: #ff6b9d;
            transform: translateY(-10px);
            box-shadow: 0 20px 40px rgba(255, 107, 157, 0.2);
        }

        .platform-icon {
            font-size: 80px;
        }

        .platform-label {
            font-size: 1.3rem;
            font-weight: 600;
            color: #fff;
        }

        /* Main Game Container */
        #game-container {
            display: none;
            width: 100%;
            height: 100%;
            position: relative;
            overflow: hidden;
        }

        /* Backgrounds */
        .background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            transition: opacity 0.5s ease;
        }

        .bg-bus-stop {
            background: linear-gradient(to bottom, #87CEEB 0%, #E0F6FF 50%, #ddd 100%);
        }

        .bg-bus-stop::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 30%;
            background: linear-gradient(to top, #555 0%, #777 100%);
        }

        .bg-bus {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
        }

        .bg-college {
            background: linear-gradient(to bottom, #74b9ff 0%, #a29bfe 100%);
        }

        .bg-medical {
            background: linear-gradient(to bottom, #55efc4 0%, #00cec9 100%);
        }

        .bg-evening {
            background: linear-gradient(to bottom, #2c3e50 0%, #fd79a8 30%, #e17055 60%, #2d3436 100%);
        }

        .bg-night {
            background: linear-gradient(to bottom, #0c0c1e 0%, #1a1a3e 50%, #2d2d5a 100%);
        }

        .bg-park {
            background: linear-gradient(to bottom, #55efc4 0%, #00b894 100%);
        }

        .bg-cafe {
            background: linear-gradient(135deg, #fdcb6e 0%, #e17055 100%);
        }

        .bg-rain {
            background: linear-gradient(to bottom, #636e72 0%, #2d3436 100%);
        }

        .bg-computer-lab {
            background: linear-gradient(135deg, #0984e3 0%, #6c5ce7 100%);
        }

        .bg-library {
            background: linear-gradient(to bottom, #dfe6e9 0%, #b2bec3 100%);
        }

        .bg-winter {
            background: linear-gradient(to bottom, #dfe6e9 0%, #74b9ff 50%, #a29bfe 100%);
        }

        /* ============================================
           CHAPTER TITLE OVERLAY - –ò–°–ü–†–ê–í–õ–ï–ù–û!
           ============================================ */
        #chapter-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0);
            z-index: 100;
            display: none;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            transition: background 0.5s ease;
        }

        #chapter-overlay.active {
            display: flex;
            background: rgba(0, 0, 0, 0.85);
        }

        #chapter-decoration-top {
            width: 300px;
            height: 2px;
            background: linear-gradient(90deg, transparent, #ff6b9d, transparent);
            margin-bottom: 30px;
            opacity: 0;
            transform: scaleX(0);
            transition: all 0.8s ease;
        }

        #chapter-overlay.active #chapter-decoration-top {
            opacity: 1;
            transform: scaleX(1);
        }

        #chapter-number {
            font-size: 1.2rem;
            color: #ff6b9d;
            text-transform: uppercase;
            letter-spacing: 8px;
            margin-bottom: 15px;
            opacity: 0;
            transform: translateY(-20px);
            transition: all 0.6s ease 0.3s;
        }

        #chapter-overlay.active #chapter-number {
            opacity: 1;
            transform: translateY(0);
        }

        #chapter-main-title {
            font-family: 'Caveat', cursive;
            font-size: 4rem;
            color: #fff;
            text-shadow: 0 0 40px rgba(255, 107, 157, 0.6),
                         0 0 80px rgba(255, 107, 157, 0.4),
                         0 4px 20px rgba(0, 0, 0, 0.5);
            text-align: center;
            padding: 0 20px;
            opacity: 0;
            transform: translateY(30px) scale(0.9);
            transition: all 0.8s ease 0.5s;
        }

        #chapter-overlay.active #chapter-main-title {
            opacity: 1;
            transform: translateY(0) scale(1);
        }

        #chapter-subtitle {
            font-size: 1.3rem;
            color: #aaa;
            margin-top: 15px;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.6s ease 0.7s;
        }

        #chapter-overlay.active #chapter-subtitle {
            opacity: 1;
            transform: translateY(0);
        }

        #chapter-decoration-bottom {
            width: 300px;
            height: 2px;
            background: linear-gradient(90deg, transparent, #ff6b9d, transparent);
            margin-top: 30px;
            opacity: 0;
            transform: scaleX(0);
            transition: all 0.8s ease 0.9s;
        }

        #chapter-overlay.active #chapter-decoration-bottom {
            opacity: 1;
            transform: scaleX(1);
        }

        /* Decorative elements */
        .chapter-sparkle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: #ff6b9d;
            border-radius: 50%;
            animation: sparkle 2s ease-in-out infinite;
        }

        @keyframes sparkle {
            0%, 100% { opacity: 0; transform: scale(0); }
            50% { opacity: 1; transform: scale(1); }
        }

        /* Character Display */
        #character-display {
            position: absolute;
            bottom: 25%;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            justify-content: center;
            align-items: flex-end;
            gap: 30px;
            z-index: 10;
        }

        .character {
            text-align: center;
            transition: all 0.3s ease;
        }

        .character.speaking {
            transform: scale(1.05);
        }

        .character-sprite {
            width: 180px;
            height: 320px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-end;
        }

        .character-avatar {
            width: 140px;
            height: 140px;
            border-radius: 50%;
            border: 4px solid #fff;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 55px;
            margin-bottom: 10px;
            position: relative;
        }

        .character-avatar::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 80px;
            border-radius: 30px 30px 0 0;
        }

        .nargiza-avatar {
            background: linear-gradient(135deg, #ff6b9d, #c44569);
        }

        .nargiza-avatar::after {
            background: linear-gradient(to bottom, #c44569, #e84393);
        }

        .nika-avatar {
            background: linear-gradient(135deg, #a29bfe, #6c5ce7);
        }

        .nika-avatar::after {
            background: linear-gradient(to bottom, #6c5ce7, #5f27cd);
        }

        .arif-avatar {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
        }

        .arif-avatar::after {
            background: linear-gradient(to bottom, #0984e3, #0652DD);
        }

        .character-name-tag {
            background: rgba(0, 0, 0, 0.8);
            padding: 5px 15px;
            border-radius: 15px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .character-role {
            font-size: 0.7rem;
            color: #aaa;
            margin-top: 3px;
        }

        /* Dialog Box */
        #dialog-box {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, rgba(0, 0, 0, 0.95), rgba(0, 0, 0, 0.85));
            border-top: 3px solid #ff6b9d;
            padding: 20px;
            min-height: 25%;
            z-index: 20;
        }

        #speaker-name {
            font-size: 1.3rem;
            font-weight: 700;
            color: #ff6b9d;
            margin-bottom: 10px;
            display: inline-block;
            background: rgba(255, 107, 157, 0.2);
            padding: 5px 20px;
            border-radius: 20px;
        }

        #speaker-name.nargiza { color: #ff6b9d; background: rgba(255, 107, 157, 0.2); }
        #speaker-name.nika { color: #a29bfe; background: rgba(162, 155, 254, 0.2); }
        #speaker-name.arif { color: #74b9ff; background: rgba(116, 185, 255, 0.2); }
        #speaker-name.bibarys { color: #fdcb6e; background: rgba(253, 203, 110, 0.2); }

        #dialog-text {
            font-size: 1.1rem;
            line-height: 1.8;
            color: #fff;
            min-height: 80px;
        }

        #continue-hint {
            position: absolute;
            bottom: 15px;
            right: 20px;
            color: #888;
            font-size: 0.9rem;
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        /* Choices */
        #choices-container {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: none;
            flex-direction: column;
            gap: 15px;
            z-index: 30;
            width: 90%;
            max-width: 600px;
        }

        .choice-btn {
            background: linear-gradient(135deg, rgba(255, 107, 157, 0.9), rgba(196, 69, 105, 0.9));
            border: none;
            padding: 18px 25px;
            font-size: 1.05rem;
            color: #fff;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Nunito', sans-serif;
            font-weight: 600;
            text-align: left;
            box-shadow: 0 5px 20px rgba(255, 107, 157, 0.3);
            position: relative;
            overflow: hidden;
        }

        .choice-btn.nika-choice {
            background: linear-gradient(135deg, rgba(162, 155, 254, 0.9), rgba(108, 92, 231, 0.9));
            box-shadow: 0 5px 20px rgba(162, 155, 254, 0.3);
        }

        .choice-btn:hover {
            transform: translateX(10px);
            box-shadow: 0 10px 30px rgba(255, 107, 157, 0.5);
        }

        .choice-btn.nika-choice:hover {
            box-shadow: 0 10px 30px rgba(162, 155, 254, 0.5);
        }

        .choice-btn::before {
            content: '‚ñ∏ ';
            opacity: 0;
            transition: opacity 0.3s;
        }

        .choice-btn:hover::before {
            opacity: 1;
        }

        /* UI Elements */
        #game-ui {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 50;
        }

        .ui-btn {
            width: 50px;
            height: 50px;
            background: rgba(0, 0, 0, 0.7);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            color: #fff;
            font-size: 1.3rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .ui-btn:hover {
            background: rgba(255, 107, 157, 0.7);
            border-color: #ff6b9d;
            transform: scale(1.1);
        }

        /* Affection Meters */
        #affection-container {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.8);
            padding: 15px 20px;
            border-radius: 15px;
            z-index: 50;
            border: 2px solid rgba(255, 107, 157, 0.3);
        }

        .affection-meter {
            margin-bottom: 12px;
        }

        .affection-meter:last-child {
            margin-bottom: 0;
        }

        .affection-label {
            font-size: 0.85rem;
            margin-bottom: 6px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .affection-label.nargiza { color: #ff6b9d; }
        .affection-label.nika { color: #a29bfe; }

        .affection-bar {
            width: 130px;
            height: 10px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            overflow: hidden;
        }

        .affection-fill {
            height: 100%;
            width: 30%;
            transition: width 0.5s ease;
            border-radius: 10px;
        }

        .affection-fill.nargiza {
            background: linear-gradient(90deg, #ff6b9d, #ff8fab);
        }

        .affection-fill.nika {
            background: linear-gradient(90deg, #a29bfe, #d5aaff);
        }

        /* Menu */
        #menu-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 200;
        }

        .menu-content {
            text-align: center;
        }

        .menu-title {
            font-family: 'Caveat', cursive;
            font-size: 3rem;
            color: #ff6b9d;
            margin-bottom: 40px;
        }

        .menu-btn {
            display: block;
            width: 250px;
            margin: 15px auto;
            padding: 15px 30px;
            background: transparent;
            border: 2px solid #ff6b9d;
            color: #fff;
            font-size: 1.2rem;
            font-family: 'Nunito', sans-serif;
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 30px;
        }

        .menu-btn:hover {
            background: #ff6b9d;
            transform: scale(1.05);
        }

        /* Ending Screen */
        #ending-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 300;
            flex-direction: column;
            padding: 20px;
        }

        .ending-good-nargiza {
            background: linear-gradient(135deg, #ff6b9d 0%, #c44569 50%, #e84393 100%);
        }

        .ending-good-nika {
            background: linear-gradient(135deg, #a29bfe 0%, #6c5ce7 50%, #5f27cd 100%);
        }

        .ending-bad {
            background: linear-gradient(135deg, #2d3436 0%, #636e72 50%, #2d3436 100%);
        }

        .ending-title {
            font-family: 'Caveat', cursive;
            font-size: 3.5rem;
            color: #fff;
            text-shadow: 0 0 30px rgba(0, 0, 0, 0.5);
            margin-bottom: 20px;
            text-align: center;
        }

        .ending-subtitle {
            font-size: 1.2rem;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 40px;
            max-width: 600px;
            text-align: center;
            line-height: 1.8;
            white-space: pre-line;
        }

        .ending-character {
            font-size: 100px;
            margin-bottom: 20px;
        }

        /* Effects */
        .fade-in {
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .slide-up {
            animation: slideUp 0.5s ease;
        }

        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* Mobile Styles */
        .mobile-mode #character-display {
            bottom: 32%;
            gap: 15px;
        }

        .mobile-mode .character-sprite {
            width: 100px;
            height: 180px;
        }

        .mobile-mode .character-avatar {
            width: 70px;
            height: 70px;
            font-size: 30px;
        }

        .mobile-mode .character-avatar::after {
            width: 40px;
            height: 50px;
        }

        .mobile-mode #dialog-box {
            min-height: 32%;
            padding: 15px;
        }

        .mobile-mode #speaker-name {
            font-size: 1rem;
            padding: 4px 15px;
        }

        .mobile-mode #dialog-text {
            font-size: 0.9rem;
            line-height: 1.6;
        }

        .mobile-mode .choice-btn {
            padding: 14px 18px;
            font-size: 0.95rem;
        }

        .mobile-mode #affection-container {
            top: 10px;
            left: 10px;
            padding: 10px 12px;
        }

        .mobile-mode .affection-bar {
            width: 80px;
            height: 8px;
        }

        .mobile-mode .affection-label {
            font-size: 0.75rem;
        }

        .mobile-mode .ui-btn {
            width: 40px;
            height: 40px;
            font-size: 1rem;
        }

        .mobile-mode #game-ui {
            top: 10px;
            right: 10px;
        }

        .mobile-mode .platform-title {
            font-size: 2.2rem;
        }

        .mobile-mode .platform-subtitle {
            font-size: 0.9rem;
            padding: 0 20px;
        }

        .mobile-mode .platform-btn {
            width: 140px;
            height: 170px;
        }

        .mobile-mode .platform-icon {
            font-size: 50px;
        }

        .mobile-mode .platform-label {
            font-size: 1rem;
        }

        .mobile-mode #chapter-main-title {
            font-size: 2.5rem;
        }

        .mobile-mode #chapter-subtitle {
            font-size: 1rem;
        }

        .mobile-mode #chapter-number {
            font-size: 1rem;
            letter-spacing: 4px;
        }

        .mobile-mode .ending-title {
            font-size: 2.5rem;
        }

        .mobile-mode .ending-subtitle {
            font-size: 1rem;
        }

        .mobile-mode .ending-character {
            font-size: 70px;
        }

        /* Heart Animation */
        .heart-float {
            position: absolute;
            font-size: 2rem;
            animation: floatUp 2s ease-out forwards;
            pointer-events: none;
            z-index: 1000;
        }

        @keyframes floatUp {
            0% { opacity: 1; transform: translateY(0) scale(1); }
            100% { opacity: 0; transform: translateY(-150px) scale(1.5); }
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 20px 40px;
            border-radius: 15px;
            border: 2px solid #ff6b9d;
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }

        .notification.nika-notif {
            border-color: #a29bfe;
        }
    </style>
</head>
<body>
    <!-- Platform Selection -->
    <div id="platform-select">
        <h1 class="platform-title">–°–µ—Ä–¥—Ü–µ –°–∞—Ç–ø–∞–µ–≤–∞</h1>
        <div class="platform-version">v2.1 ‚Äî –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è</div>
        <p class="platform-subtitle">–í–∏–∑—É–∞–ª—å–Ω–∞—è –Ω–æ–≤–µ–ª–ª–∞ ‚Ä¢ –£–ª—ã—Ç–∞—É—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å<br>üéÆ –ü–æ–ª–∏—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –∫–æ–ª–ª–µ–¥–∂ ‚Ä¢ –ü—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç—ã</p>
        <div class="platform-buttons">
            <button class="platform-btn" onclick="selectPlatform('desktop')">
                <span class="platform-icon">üñ•Ô∏è</span>
                <span class="platform-label">–ö–æ–º–ø—å—é—Ç–µ—Ä</span>
            </button>
            <button class="platform-btn" onclick="selectPlatform('mobile')">
                <span class="platform-icon">üì±</span>
                <span class="platform-label">–¢–µ–ª–µ—Ñ–æ–Ω</span>
            </button>
        </div>
    </div>

    <!-- Game Container -->
    <div id="game-container">
        <!-- Background -->
        <div id="background" class="background bg-bus-stop"></div>
        
        <!-- Chapter Overlay - –ù–û–í–´–ô –ö–†–ê–°–ò–í–´–ô OVERLAY -->
        <div id="chapter-overlay">
            <div id="chapter-decoration-top"></div>
            <div id="chapter-number"></div>
            <div id="chapter-main-title"></div>
            <div id="chapter-subtitle"></div>
            <div id="chapter-decoration-bottom"></div>
        </div>
        
        <!-- Affection Meters -->
        <div id="affection-container">
            <div class="affection-meter">
                <div class="affection-label nargiza">üíó –ù–∞—Ä–≥–∏–∑–∞</div>
                <div class="affection-bar">
                    <div id="affection-fill-nargiza" class="affection-fill nargiza"></div>
                </div>
            </div>
            <div class="affection-meter">
                <div class="affection-label nika">üíú –ù–∏–∫–∞</div>
                <div class="affection-bar">
                    <div id="affection-fill-nika" class="affection-fill nika"></div>
                </div>
            </div>
        </div>

        <!-- UI Buttons -->
        <div id="game-ui">
            <button class="ui-btn" onclick="toggleMenu()" title="–ú–µ–Ω—é">‚ò∞</button>
            <button class="ui-btn" onclick="saveGame()" title="–°–æ—Ö—Ä–∞–Ω–∏—Ç—å">üíæ</button>
            <button class="ui-btn" onclick="toggleAuto()" id="auto-btn" title="–ê–≤—Ç–æ">‚ñ∂Ô∏è</button>
        </div>

        <!-- Character Display -->
        <div id="character-display"></div>

        <!-- Dialog Box -->
        <div id="dialog-box" onclick="advanceDialog()">
            <div id="speaker-name">???</div>
            <div id="dialog-text"></div>
            <div id="continue-hint">‚ñº –ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å</div>
        </div>

        <!-- Choices Container -->
        <div id="choices-container"></div>
    </div>

    <!-- Menu Overlay -->
    <div id="menu-overlay">
        <div class="menu-content">
            <h2 class="menu-title">–ú–µ–Ω—é</h2>
            <button class="menu-btn" onclick="toggleMenu()">‚ñ∂Ô∏è –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
            <button class="menu-btn" onclick="saveGame()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            <button class="menu-btn" onclick="loadGame()">üìÇ –ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
            <button class="menu-btn" onclick="restartGame()">üîÑ –ù–∞—á–∞—Ç—å —Å–Ω–∞—á–∞–ª–∞</button>
        </div>
    </div>

    <!-- Ending Screen -->
    <div id="ending-screen">
        <div class="ending-character" id="ending-emoji"></div>
        <h1 class="ending-title" id="ending-title"></h1>
        <p class="ending-subtitle" id="ending-subtitle"></p>
        <button class="menu-btn" onclick="restartGame()">üîÑ –ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞</button>
    </div>

    <script>
        // Game State
        let gameState = {
            platform: null,
            currentScene: 0,
            affectionNargiza: 30,
            affectionNika: 20,
            chapter: 1,
            flags: {},
            autoMode: false,
            route: null,
            textComplete: false,
            currentText: '',
            currentTextIndex: 0
        };

        // Typewriter variables
        let typewriterInterval = null;

        // Characters Data
        const characters = {
            nargiza: {
                name: '–ù–∞—Ä–≥–∏–∑–∞',
                emoji: 'üë©',
                role: '–°—Ç—É–¥–µ–Ω—Ç–∫–∞ –º–µ–¥. –∫–æ–ª–ª–µ–¥–∂–∞',
                colorClass: 'nargiza-avatar'
            },
            nika: {
                name: '–ù–∏–∫–∞',
                emoji: 'üë©‚Äçü¶∞',
                role: '–ü–æ–¥—Ä—É–≥–∞ –ù–∞—Ä–≥–∏–∑—ã',
                colorClass: 'nika-avatar'
            },
            arif: {
                name: '–ê—Ä–∏—Ñ',
                emoji: 'üë®‚Äçüíª',
                role: '–î—Ä—É–≥, –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç',
                colorClass: 'arif-avatar'
            }
        };

        // Story Data
        const story = [
            // ========== CHAPTER 1 ==========
            {
                type: "chapter",
                number: "–ì–ª–∞–≤–∞ 1",
                title: "–ê–≤—Ç–æ–±—É—Å 101",
                subtitle: "–°–∞—Ç–ø–∞–µ–≤ ‚Äî –ñ–µ–∑–∫–∞–∑–≥–∞–Ω",
                background: "bg-bus-stop"
            },
            {
                type: "dialog",
                speaker: "–ë–∏–±–∞—Ä—ã—Å",
                speakerClass: "bibarys",
                text: "–û—á–µ—Ä–µ–¥–Ω–æ–µ —É—Ç—Ä–æ –≤ –°–∞—Ç–ø–∞–µ–≤–µ... –û–ø—è—Ç—å –∂–¥—É –∞–≤—Ç–æ–±—É—Å 101 –¥–æ –ñ–µ–∑–∫–∞–∑–≥–∞–Ω–∞. –£—á—É—Å—å –Ω–∞ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç–∞ –≤ –ü–æ–ª–∏—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–º –∫–æ–ª–ª–µ–¥–∂–µ ‚Äî –ø–∏—à—É –∫–æ–¥, –¥–µ–ª–∞—é –ø—Ä–æ–µ–∫—Ç—ã...",
                background: "bg-bus-stop",
                characters: []
            },
            {
                type: "dialog",
                speaker: "–ë–∏–±–∞—Ä—ã—Å",
                speakerClass: "bibarys",
                text: "–£–ª—ã—Ç–∞—É—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å ‚Äî –Ω–µ –°–∏–ª–∏–∫–æ–Ω–æ–≤–∞—è –¥–æ–ª–∏–Ω–∞, –∫–æ–Ω–µ—á–Ω–æ. –ù–æ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç –µ—Å—Ç—å, IDE —Ä–∞–±–æ—Ç–∞–µ—Ç, –∞ —á—Ç–æ –µ—â—ë –Ω—É–∂–Ω–æ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç—É?",
                background: "bg-bus-stop",
                characters: []
            },
            {
                type: "dialog",
                speaker: "–ê—Ä–∏—Ñ",
                speakerClass: "arif",
                text: "–ô–æ—É, –ë–∏–±–∞—Ä—ã—Å! –¢—ã —á–µ–≥–æ —Ç–∞–∫–æ–π –∑–∞–¥—É–º—á–∏–≤—ã–π? –û–ø—è—Ç—å –≤—Å—é –Ω–æ—á—å –∫–æ–¥ –¥–µ–±–∞–∂–∏–ª?",
                background: "bg-bus-stop",
                characters: ["arif"]
            },
            {
                type: "dialog",
                speaker: "–ë–∏–±–∞—Ä—ã—Å",
                speakerClass: "bibarys",
                text: "–ü—Ä–∏–≤–µ—Ç, –ê—Ä–∏—Ñ! –î–∞, –±–∞–≥ –æ–¥–∏–Ω –Ω–∏–∫–∞–∫ –Ω–µ –º–æ–≥ –Ω–∞–π—Ç–∏. –í —Ç—Ä–∏ —á–∞—Å–∞ –Ω–æ—á–∏ —Ç–æ–ª—å–∫–æ –ø–æ–Ω—è–ª, —á—Ç–æ —Ç–æ—á–∫—É —Å –∑–∞–ø—è—Ç–æ–π –∑–∞–±—ã–ª...",
                background: "bg-bus-stop",
                characters: ["arif"]
            },
            {
                type: "dialog",
                speaker: "–ê—Ä–∏—Ñ",
                speakerClass: "arif",
                text: "–ö–ª–∞—Å—Å–∏–∫–∞! –£ –º–µ–Ω—è —Ç–∞–∫–æ–µ —Ç–æ–∂–µ –±—ã–ª–æ. –°–ª—É—à–∞–π, –∞ —Ç—ã –∑–∞–º–µ—Ç–∏–ª —Ç–µ—Ö –¥–≤—É—Ö –¥–µ–≤—É—à–µ–∫? –ö–æ—Ç–æ—Ä—ã–µ —Ç–æ–∂–µ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –Ω–∞ 101-–º –µ–∑–¥—è—Ç?",
                background: "bg-bus-stop",
                characters: ["arif"]
            },
            {
                type: "dialog",
                speaker: "–ë–∏–±–∞—Ä—ã—Å",
                speakerClass: "bibarys",
                text: "–ö–∞–∫–∏—Ö –¥–µ–≤—É—à–µ–∫?",
                background: "bg-bus-stop",
                characters: ["arif"]
            },
            {
                type: "dialog",
                speaker: "–ê—Ä–∏—Ñ",
                speakerClass: "arif",
                text: "–í–æ–Ω –æ–Ω–∏ –∏–¥—É—Ç! –û–¥–Ω–∞ ‚Äî –ù–∞—Ä–≥–∏–∑–∞, –≤ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–º —É—á–∏—Ç—Å—è. –ê –≤—Ç–æ—Ä–∞—è ‚Äî –µ—ë –ø–æ–¥—Ä—É–≥–∞ –ù–∏–∫–∞. –û–±–µ –∏–∑ –°–∞—Ç–ø–∞–µ–≤–∞.",
                background: "bg-bus-stop",
                characters: ["arif"]
            },
            {
                type: "dialog",
                speaker: "",
                text: "–Ø –ø–æ—Å–º–æ—Ç—Ä–µ–ª –≤ —Å—Ç–æ—Ä–æ–Ω—É, –∫—É–¥–∞ —É–∫–∞–∑—ã–≤–∞–ª –ê—Ä–∏—Ñ. –ö –æ—Å—Ç–∞–Ω–æ–≤–∫–µ —à–ª–∏ –¥–≤–µ –¥–µ–≤—É—à–∫–∏. –û–¥–Ω–∞ —Å –¥–ª–∏–Ω–Ω—ã–º–∏ —Ç—ë–º–Ω—ã–º–∏ –≤–æ–ª–æ—Å–∞–º–∏ –≤ –±–µ–∂–µ–≤–æ–º –ø–∞–ª—å—Ç–æ, –¥—Ä—É–≥–∞—è ‚Äî —Å —Ä—ã–∂–µ–≤–∞—Ç—ã–º–∏ –≤–æ–ª–æ—Å–∞–º–∏ –≤ —Ñ–∏–æ–ª–µ—Ç–æ–≤–æ–π –∫—É—Ä—Ç–∫–µ.",
                background: "bg-bus-stop",
                characters: ["nargiza", "nika"]
            },
            {
                type: "dialog",
                speaker: "–ê—Ä–∏—Ñ",
                speakerClass: "arif",
                text: "–ù–∞—Ä–≥–∏–∑–∞ ‚Äî —Ç–∞, —á—Ç–æ –≤ –±–µ–∂–µ–≤–æ–º. –•–æ—á–µ—Ç —Å—Ç–∞—Ç—å —Ö–∏—Ä—É—Ä–≥–æ–º. –ê –ù–∏–∫–∞ ‚Äî –≤–µ—Å—ë–ª–∞—è —Ç–∞–∫–∞—è, –ø–æ—Å—Ç–æ—è–Ω–Ω–æ —à—É—Ç–∏—Ç.",
                background: "bg-bus-stop",
                characters: ["nargiza", "nika", "arif"]
            },
            {
                type: "choice",
                question: "–ù–∞ –∫–æ–≥–æ —è –æ–±—Ä–∞—Ç–∏–ª –±–æ–ª—å—à–µ –≤–Ω–∏–º–∞–Ω–∏—è?",
                choices: [
                    { 
                        text: "–ù–∞ –ù–∞—Ä–≥–∏–∑—É ‚Äî –æ–Ω–∞ –∫–∞–∫–∞—è-—Ç–æ –∑–∞–≥–∞–¥–æ—á–Ω–∞—è...", 
                        next: 11, 
                        affectionNargiza: 5,
                        affectionNika: 0,
                        flag: "noticed_nargiza"
                    },
                    { 
                        text: "–ù–∞ –ù–∏–∫—É ‚Äî —É –Ω–µ—ë —Ç–∞–∫–∞—è —è—Ä–∫–∞—è —É–ª—ã–±–∫–∞!", 
                        next: 13, 
                        affectionNargiza: 0,
                        affectionNika: 5,
                        flag: "noticed_nika",
                        nikaChoice: true
                    },
                    { 
                        text: "–û–±–µ —Å–∏–º–ø–∞—Ç–∏—á–Ω—ã–µ, –Ω–æ –º–Ω–µ —Å–µ–π—á–∞—Å –Ω–µ –¥–æ —ç—Ç–æ–≥–æ", 
                        next: 15, 
                        affectionNargiza: -5,
                        affectionNika: -5
                    }
                ]
            },
            // Noticed Nargiza
            {
                type: "dialog",
                speaker: "–ë–∏–±–∞—Ä—ã—Å",
                speakerClass: "bibarys",
                text: "(–ù–∞—Ä–≥–∏–∑–∞... –í –Ω–µ–π –µ—Å—Ç—å —á—Ç–æ-—Ç–æ –æ—Å–æ–±–µ–Ω–Ω–æ–µ. –¢–∞–∫–∞—è —Å–ø–æ–∫–æ–π–Ω–∞—è, —É–≤–µ—Ä–µ–Ω–Ω–∞—è...)",
                background: "bg-bus-stop",
                characters: ["nargiza", "nika"],
                nextScene: 17
            },
            {
                type: "dialog",
                speaker: "–ê—Ä–∏—Ñ",
                speakerClass: "arif",
                text: "–û, —è –≤–∏–∂—É –∫—É–¥–∞ —Ç—ã —Å–º–æ—Ç—Ä–∏—à—å! –ù–∞—Ä–≥–∏–∑–∞, –¥–∞? –£ —Ç–µ–±—è —Ö–æ—Ä–æ—à–∏–π –≤–∫—É—Å, –±—Ä–æ!",
                background: "bg-bus-stop",
                characters: ["nargiza", "nika", "arif"],
                nextScene: 17
            },
            // Noticed Nika
            {
                type: "dialog",
                speaker: "–ë–∏–±–∞—Ä—ã—Å",
                speakerClass: "bibarys",
                text: "(–ù–∏–∫–∞... –ö–∞–∫–∞—è —É –Ω–µ—ë –∑–∞—Ä–∞–∑–∏—Ç–µ–ª—å–Ω–∞—è —É–ª—ã–±–∫–∞! –ò —ç—Ç–∏ —Ä—ã–∂–∏–µ –≤–æ–ª–æ—Å—ã...)",
                background: "bg-bus-stop",
                characters: ["nargiza", "nika"],
                nextScene: 17
            },
            {
                type: "dialog",
                speaker: "–ê—Ä–∏—Ñ",
                speakerClass: "arif",
                text: "–•–µ—Ö, –ù–∏–∫–∞? –û–Ω–∞ –ø—Ä–∏–∫–æ–ª—å–Ω–∞—è! –ì–æ–≤–æ—Ä—è—Ç, —Ç–æ–∂–µ –≤ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–º, –Ω–æ –Ω–∞ –¥—Ä—É–≥–æ–º –∫—É—Ä—Å–µ. –í—Å–µ–≥–¥–∞ —Å –ù–∞—Ä–≥–∏–∑–æ–π –≤–º–µ—Å—Ç–µ.",
                background: "bg-bus-stop",
                characters: ["nargiza", "nika", "arif"],
                nextScene: 17
            },
            // Not interested
            {
                type: "dialog",
                speaker: "–ê—Ä–∏—Ñ",
                speakerClass: "arif",
                text: "–≠—Ö, —Ç—ã –±–µ–∑–Ω–∞–¥—ë–∂–µ–Ω! –í–µ—á–Ω–æ –≤ —Å–≤–æ—ë–º –∫–æ–¥–µ –∂–∏–≤—ë—à—å!",
                background: "bg-bus-stop",
                characters: ["arif"],
                nextScene: 17
            },
            {
                type: "dialog",
                speaker: "–ë–∏–±–∞—Ä—ã—Å",
                speakerClass: "bibarys",
                text: "–£ –º–µ–Ω—è –¥–µ–¥–ª–∞–π–Ω –Ω–∞ –Ω–æ—Å—É, –Ω–µ –¥–æ –¥–µ–≤—É—à–µ–∫ —Å–µ–π—á–∞—Å...",
                background: "bg-bus-stop",
                characters: ["arif"],
                nextScene: 17
            },
            // Continue
            {
                type: "dialog",
                speaker: "",
                text: "–î–µ–≤—É—à–∫–∏ –ø–æ–¥–æ—à–ª–∏ –∫ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ. –ù–∞—Ä–≥–∏–∑–∞ —á—Ç–æ-—Ç–æ —á–∏—Ç–∞–ª–∞ –≤ —Ç–µ–ª–µ—Ñ–æ–Ω–µ, –∞ –ù–∏–∫–∞ –∑–∞–º–µ—Ç–∏–ª–∞ –Ω–∞—Å –∏ –ø–æ–º–∞—Ö–∞–ª–∞ —Ä—É–∫–æ–π.",
                background: "bg-bus-stop",
                characters: ["nargiza", "nika"]
            },
            {
                type: "dialog",
                speaker: "–ù–∏–∫–∞",
                speakerClass: "nika",
                text: "–ü—Ä–∏–≤–µ—Ç! –í—ã —Ç–æ–∂–µ –≤ –ñ–µ–∑–∫–∞–∑–≥–∞–Ω? –ù–∞ –ü–æ–ª–∏—Ç–µ—Ö, –¥–∞? –Ø –≤–∞—Å —Ç–∞–º –≤–∏–¥–µ–ª–∞!",
                background: "bg-bus-stop",
                characters: ["nargiza", "nika"]
            },
            {
                type: "dialog",
                speaker: "–ê—Ä–∏—Ñ",
                speakerClass: "arif",
                text: "–ê–≥–∞, –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç—ã –º—ã! –ë—É–¥—É—â–∏–µ IT-–≥–µ–Ω–∏–∏!",
                background: "bg-bus-stop",
                characters: ["nargiza", "nika", "arif"]
            },
            {
                type: "dialog",
                speaker: "–ù–∞—Ä–≥–∏–∑–∞",
                speakerClass: "nargiza",
                text: "–ü—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç—ã? –ò–Ω—Ç–µ—Ä–µ—Å–Ω–æ. –ú–æ–∂–µ—Ç, –ø–æ–º–æ–∂–µ—Ç–µ –ø–æ—Ç–æ–º —Å –∫–æ–º–ø—å—é—Ç–µ—Ä–æ–º? –£ –º–µ–Ω—è –≤–µ—á–Ω–æ —á—Ç–æ-—Ç–æ –ª–æ–º–∞–µ—Ç—Å—è.",
                background: "bg-bus-stop",
                characters: ["nargiza", "nika"]
            },
            {
                type: "choice",
                question: "–ß—Ç–æ –æ—Ç–≤–µ—Ç–∏—Ç—å?",
                choices: [
                    { 
                        text: "\"–ö–æ–Ω–µ—á–Ω–æ –ø–æ–º–æ–≥—É! –≠—Ç–æ –º–æ—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å!\" (—Å–º–æ—Ç—Ä—è –Ω–∞ –ù–∞—Ä–≥–∏–∑—É)", 
                        next: 22, 
                        affectionNargiza: 10,
                        affectionNika: 0
                    },
                    { 
                        text: "\"–ú—ã –æ–±–∞ –º–æ–∂–µ–º –ø–æ–º–æ—á—å! –ü—Ä–∞–≤–¥–∞, –ê—Ä–∏—Ñ?\" (—Å–º–æ—Ç—Ä—è –Ω–∞ –ù–∏–∫—É)", 
                        next: 25, 
                        affectionNargiza: 5,
                        affectionNika: 10,
                        nikaChoice: true
                    },
                    { 
                        text: "\"–ù—É, –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –ø—Ä–æ–±–ª–µ–º—ã...\" (–Ω–µ—É–≤–µ—Ä–µ–Ω–Ω–æ)", 
                        next: 28, 
                        affectionNargiza: 0,
                        affectionNika: 0
                    }
                ]
            },
            // Respond to Nargiza
            {
                type: "dialog",
                speaker: "–ù–∞—Ä–≥–∏–∑–∞",
                speakerClass: "nargiza",
                text: "–ü—Ä–∞–≤–¥–∞? –≠—Ç–æ –±—ã–ª–æ –±—ã –∑–¥–æ—Ä–æ–≤–æ! –Ø –ù–∞—Ä–≥–∏–∑–∞, –∫—Å—Ç–∞—Ç–∏.",
                background: "bg-bus-stop",
                characters: ["nargiza", "nika"]
            },
            {
                type: "dialog",
                speaker: "–ë–∏–±–∞—Ä—ã—Å",
                speakerClass: "bibarys",
                text: "–ë–∏–±–∞—Ä—ã—Å. –û—á–µ–Ω—å –ø—Ä–∏—è—Ç–Ω–æ!",
                background: "bg-bus-stop",
                characters: ["nargiza", "nika"]
            },
            {
                type: "dialog",
                speaker: "–ù–∏–∫–∞",
                speakerClass: "nika",
                text: "–û–π, –∫–∞–∫–∏–µ –≤—ã —Å–µ—Ä—å—ë–∑–Ω—ã–µ! –Ø –ù–∏–∫–∞! –ü–æ–¥—Ä—É–≥–∞ —ç—Ç–æ–π –≤–æ—Ç —É–º–Ω–∏—Ü—ã.",
                background: "bg-bus-stop",
                characters: ["nargiza", "nika"],
                nextScene: 31
            },
            // Respond friendly to both
            {
                type: "dialog",
                speaker: "–ù–∏–∫–∞",
                speakerClass: "nika",
                text: "–û, –¥–≤–∞ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç–∞! –í–æ–æ–±—â–µ —Å—É–ø–µ—Ä! –ù–∞—Ä–≥–∏–∑–∞, —Ç–µ–ø–µ—Ä—å —É –Ω–∞—Å —Å–≤–æ—è IT-–ø–æ–¥–¥–µ—Ä–∂–∫–∞!",
                background: "bg-bus-stop",
                characters: ["nargiza", "nika"]
            },
            {
                type: "dialog",
                speaker: "–ù–∞—Ä–≥–∏–∑–∞",
                speakerClass: "nargiza",
                text: "–ù–∏–∫–∞, –Ω–µ –ø—É–≥–∞–π —Ä–µ–±—è—Ç. –ú—ã –µ—â—ë –¥–∞–∂–µ –Ω–µ –ø–æ–∑–Ω–∞–∫–æ–º–∏–ª–∏—Å—å –Ω–æ—Ä–º–∞–ª—å–Ω–æ.",
                background: "bg-bus-stop",
                characters: ["nargiza", "nika"]
            },
            {
                type: "dialog",
                speaker: "–ù–∏–∫–∞",
                speakerClass: "nika",
                text: "–Ø –ù–∏–∫–∞! –ê —ç—Ç–æ –ù–∞—Ä–≥–∏–∑–∞! –ú—ã –≤ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–º —É—á–∏–º—Å—è. –ê –≤–∞—Å –∫–∞–∫ –∑–æ–≤—É—Ç?",
                background: "bg-bus-stop",
                characters: ["nargiza", "nika"],
                nextScene: 31
            },
            // Unsure response
            {
                type: "dialog",
                speaker: "–ù–∏–∫–∞",
                speakerClass: "nika",
                text: "–•–∞—Ö–∞, —Å–∫—Ä–æ–º–Ω–∏—á–∞–µ—Ç! –õ–∞–¥–Ω–æ, –Ω–µ –±—É–¥–µ–º –Ω–∞–ø—Ä—è–≥–∞—Ç—å. –Ø –ù–∏–∫–∞, –∫—Å—Ç–∞—Ç–∏!",
                background: "bg-bus-stop",
                characters: ["nargiza", "nika"]
            },
            {
                type: "dialog",
                speaker: "–ù–∞—Ä–≥–∏–∑–∞",
                speakerClass: "nargiza",
                text: "–ù–∞—Ä–≥–∏–∑–∞. –ü—Ä–æ—Å—Ç–∏—Ç–µ, –µ—Å–ª–∏ —è –∫–∞–∫-—Ç–æ —Å—Ç—Ä–∞–Ω–Ω–æ –ø–æ–ø—Ä–æ—Å–∏–ª–∞...",
                background: "bg-bus-stop",
                characters: ["nargiza", "nika"]
            },
            {
                type: "dialog",
                speaker: "–ë–∏–±–∞—Ä—ã—Å",
                speakerClass: "bibarys",
                text: "–ù–µ—Ç-–Ω–µ—Ç, –≤—Å—ë –Ω–æ—Ä–º–∞–ª—å–Ω–æ! –Ø –ë–∏–±–∞—Ä—ã—Å, –∞ —ç—Ç–æ –ê—Ä–∏—Ñ.",
                background: "bg-bus-stop",
                characters: ["nargiza", "nika", "arif"],
                nextScene: 31
            },
            // Bus arrives
            {
                type: "dialog",
                speaker: "",
                text: "–ü–æ–¥—ä–µ—Ö–∞–ª –∞–≤—Ç–æ–±—É—Å 101. –ú—ã –≤—Å–µ –≤–º–µ—Å—Ç–µ –∑–∞—à–ª–∏ –≤–Ω—É—Ç—Ä—å.",
                background: "bg-bus",
                characters: []
            },
            {
                type: "dialog",
                speaker: "–ê—Ä–∏—Ñ",
                speakerClass: "arif",
                text: "–ë—Ä–æ, –µ—Å—Ç—å –¥–≤–∞ —Å–≤–æ–±–æ–¥–Ω—ã—Ö –º–µ—Å—Ç–∞ —Å–∑–∞–¥–∏. –†—è–¥–æ–º —Å –¥–µ–≤—á–æ–Ω–∫–∞–º–∏! –ò–¥–∏!",
                background: "bg-bus",
                characters: ["arif"]
            },
            {
                type: "choice",
                question: "–†—è–¥–æ–º —Å –∫–µ–º —Å–µ—Å—Ç—å?",
                choices: [
                    { 
                        text: "–°—è–¥—É —Ä—è–¥–æ–º —Å –ù–∞—Ä–≥–∏–∑–æ–π", 
                        next: 34, 
                        affectionNargiza: 15,
                        affectionNika: -5,
                        flag: "sat_with_nargiza"
                    },
                    { 
                        text: "–°—è–¥—É —Ä—è–¥–æ–º —Å –ù–∏–∫–æ–π", 
                        next: 39, 
                        affectionNargiza: -5,
                        affectionNika: 15,
                        flag: "sat_with_nika",
                        nikaChoice: true
                    },
                    { 
                        text: "–õ—É—á—à–µ —Å—è–¥—É —Å –ê—Ä–∏—Ñ–æ–º", 
                        next: 44, 
                        affectionNargiza: -10,
                        affectionNika: -10
                    }
                ]
            },
            // Sat with Nargiza
            {
                type: "dialog",
                speaker: "–ë–∏–±–∞—Ä—ã—Å",
                speakerClass: "bibarys",
                text: "–ú–æ–∂–Ω–æ –∑–¥–µ—Å—å?",
                background: "bg-bus",
                characters: ["nargiza"]
            },
            {
                type: "dialog",
                speaker: "–ù–∞—Ä–≥–∏–∑–∞",
                speakerClass: "nargiza",
                text: "–ö–æ–Ω–µ—á–Ω–æ! –°–∞–¥–∏—Å—å.",
                background: "bg-bus",
                characters: ["nargiza"]
            },
            {
                type: "dialog",
                speaker: "–ù–∞—Ä–≥–∏–∑–∞",
                speakerClass: "nargiza",
                text: "–¢–∞–∫ —Ç—ã –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç... –≠—Ç–æ —Å–ª–æ–∂–Ω–æ? –Ø –≤ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞—Ö –≤–æ–æ–±—â–µ –Ω–µ —Ä–∞–∑–±–∏—Ä–∞—é—Å—å.",
                background: "bg-bus",
                characters: ["nargiza"]
            },
            {
                type: "dialog",
                speaker: "–ë–∏–±–∞—Ä—ã—Å",
                speakerClass: "bibarys",
                text: "–°–Ω–∞—á–∞–ª–∞ —Å–ª–æ–∂–Ω–æ, –ø–æ—Ç–æ–º –ø—Ä–∏–≤—ã–∫–∞–µ—à—å. –≠—Ç–æ –∫–∞–∫ –∏–Ω–æ—Å—Ç—Ä–∞–Ω–Ω—ã–π —è–∑—ã–∫ ‚Äî –≥–ª–∞–≤–Ω–æ–µ –ø—Ä–∞–∫—Ç–∏–∫–∞. –ê —Ç—ã –Ω–∞ —Ö–∏—Ä—É—Ä–≥–∞ —É—á–∏—à—å—Å—è?",
                background: "bg-bus",
                characters: ["nargiza"]
            },
            {
                type: "dialog",
                speaker: "–ù–∞—Ä–≥–∏–∑–∞",
                speakerClass: "nargiza",
                text: "–î–∞! –≠—Ç–æ –º–æ—è –º–µ—á—Ç–∞. –ü–æ–º–æ–≥–∞—Ç—å –ª—é–¥—è–º, —Å–ø–∞—Å–∞—Ç—å –∂–∏–∑–Ω–∏... –ó–≤—É—á–∏—Ç –ø–∞—Ñ–æ—Å–Ω–æ, –Ω–æ —è –ø—Ä–∞–≤–¥–∞ —ç—Ç–æ–≥–æ —Ö–æ—á—É.",
                background: "bg-bus",
                characters: ["nargiza"],
                nextScene: 49
            },
            // Sat with Nika
            {
                type: "dialog",
                speaker: "–ë–∏–±–∞—Ä—ã—Å",
                speakerClass: "bibarys",
                text: "–ü—Ä–∏–≤–µ—Ç! –ó–¥–µ—Å—å —Å–≤–æ–±–æ–¥–Ω–æ?",
                background: "bg-bus",
                characters: ["nika"]
            },
            {
                type: "dialog",
                speaker: "–ù–∏–∫–∞",
                speakerClass: "nika",
                text: "–î–ª—è –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç–∞ ‚Äî –≤—Å–µ–≥–¥–∞! –°–∞–¥–∏—Å—å!",
                background: "bg-bus",
                characters: ["nika"]
            },
            {
                type: "dialog",
                speaker: "–ù–∏–∫–∞",
                speakerClass: "nika",
                text: "–¢–∞–∫, –ë–∏–±–∞—Ä—ã—Å, –¥–∞? –ü—Ä–∏–∫–æ–ª—å–Ω–æ–µ –∏–º—è! –¢—ã –º–µ—Å—Ç–Ω—ã–π, –∏–∑ –°–∞—Ç–ø–∞–µ–≤–∞?",
                background: "bg-bus",
                characters: ["nika"]
            },
            {
                type: "dialog",
                speaker: "–ë–∏–±–∞—Ä—ã—Å",
                speakerClass: "bibarys",
                text: "–ê–≥–∞, –≤—Å—é –∂–∏–∑–Ω—å –∑–¥–µ—Å—å. –ê –≤—ã —Å –ù–∞—Ä–≥–∏–∑–æ–π –¥–∞–≤–Ω–æ –¥—Ä—É–∂–∏—Ç–µ?",
                background: "bg-bus",
                characters: ["nika"]
            },
            {
                type: "dialog",
                speaker: "–ù–∏–∫–∞",
                speakerClass: "nika",
                text: "–° –¥–µ—Ç—Å—Ç–≤–∞! –ú—ã —Å–æ—Å–µ–¥–∫–∏ –±—ã–ª–∏. –û–Ω–∞ —Å–µ—Ä—å—ë–∑–Ω–∞—è, —è ‚Äî –Ω–∞–æ–±–æ—Ä–æ—Ç. –ò–¥–µ–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å! –ê —Ç—ã –∫–∞–∫–æ–π ‚Äî —Å–µ—Ä—å—ë–∑–Ω—ã–π –∏–ª–∏ –≤–µ—Å—ë–ª—ã–π?",
                background: "bg-bus",
                characters: ["nika"],
                nextScene: 49
            },
            // Sat with Arif
            {
                type: "dialog",
                speaker: "–ê—Ä–∏—Ñ",
                speakerClass: "arif",
                text: "–°–µ—Ä—å—ë–∑–Ω–æ?! –¢—ã –æ–ø—è—Ç—å —É–ø—É—Å–∫–∞–µ—à—å —à–∞–Ω—Å!",
                background: "bg-bus",
                characters: ["arif"]
            },
            {
                type: "dialog",
                speaker: "–ë–∏–±–∞—Ä—ã—Å",
                speakerClass: "bibarys",
                text: "–ú–Ω–µ –Ω–µ—É–¥–æ–±–Ω–æ –∫–∞–∫-—Ç–æ... –ú—ã –∂–µ —Ç–æ–ª—å–∫–æ –ø–æ–∑–Ω–∞–∫–æ–º–∏–ª–∏—Å—å.",
                background: "bg-bus",
                characters: ["arif"]
            },
            {
                type: "dialog",
                speaker: "",
                text: "–Ø –≤–∏–¥–µ–ª, –∫–∞–∫ –ù–∏–∫–∞ –∏ –ù–∞—Ä–≥–∏–∑–∞ –ø–µ—Ä–µ–≥–ª—è–Ω—É–ª–∏—Å—å. –ö–∞–∂–µ—Ç—Å—è, –æ–Ω–∏ –æ–∂–∏–¥–∞–ª–∏, —á—Ç–æ —è —Å—è–¥—É —Å –Ω–∏–º–∏... –£–ø—É—â–µ–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç.",
                background: "bg-bus",
                characters: ["arif"]
            },
            {
                type: "dialog",
                speaker: "–ê—Ä–∏—Ñ",
                speakerClass: "arif",
                text: "–õ–∞–¥–Ω–æ, –¥–∞–≤–∞–π —Ö–æ—Ç—å –ø—Ä–æ –Ω–æ–≤—ã–π —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ —Ä–∞—Å—Å–∫–∞–∂—É...",
                background: "bg-bus",
                characters: ["arif"],
                nextScene: 49
            },
            {
                type: "dialog",
                speaker: "",
                text: "–î–æ—Ä–æ–≥–∞ –æ—Ç –°–∞—Ç–ø–∞–µ–≤–∞ –¥–æ –ñ–µ–∑–∫–∞–∑–≥–∞–Ω–∞ –ø—Ä–æ–ª–µ—Ç–µ–ª–∞ –Ω–µ–∑–∞–º–µ—Ç–Ω–æ. –ú—ã –ø—Ä–∏–µ—Ö–∞–ª–∏ –∫ –∫–æ–ª–ª–µ–¥–∂–∞–º.",
                background: "bg-college",
                characters: []
            },
            // ========== CHAPTER 2 ==========
            {
                type: "chapter",
                number: "–ì–ª–∞–≤–∞ 2",
                title: "–°–±–ª–∏–∂–µ–Ω–∏–µ",
                subtitle: "–ù–µ–¥–µ–ª—é —Å–ø—É—Å—Ç—è",
                background: "bg-park"
            },
            {
                type: "dialog",
                speaker: "",
                text: "–ü—Ä–æ—à–ª–∞ –Ω–µ–¥–µ–ª—è. –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –º—ã –≤—Å—Ç—Ä–µ—á–∞–ª–∏—Å—å –Ω–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ 101. –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –æ–±—â–µ–Ω–∏–µ —Å—Ç–∞–Ω–æ–≤–∏–ª–æ—Å—å –≤—Å—ë –±–æ–ª–µ–µ –Ω–µ–ø—Ä–∏–Ω—É–∂–¥—ë–Ω–Ω—ã–º.",
                background: "bg-bus-stop",
                characters: ["nargiza", "nika"]
            },
            {
                type: "dialog",
                speaker: "–ê—Ä–∏—Ñ",
                speakerClass: "arif",
                text: "–°–ª—É—à–∞–π, —Å–µ–≥–æ–¥–Ω—è –≤–µ—á–µ—Ä–æ–º —É –º–µ–Ω—è –∏–¥–µ—è ‚Äî –º–æ–∂–µ—Ç –≤ –ø–∞—Ä–∫ –≤ –°–∞—Ç–ø–∞–µ–≤–µ —Å—Ö–æ–¥–∏–º? –í—Å–µ –≤–º–µ—Å—Ç–µ?",
                background: "bg-bus-stop",
                characters: ["arif"]
            },
            {
                type: "dialog",
                speaker: "–ù–∏–∫–∞",
                speakerClass: "nika",
                text: "–û —á—ë–º —à–µ–ø—á–µ—Ç–µ—Å—å, –º–∞–ª—å—á–∏–∫–∏? –ó–∞–≥–æ–≤–æ—Ä –∫–∞–∫–æ–π-—Ç–æ?",
                background: "bg-bus-stop",
                characters: ["nika", "arif"]
            },
            {
                type: "dialog",
                speaker: "–ê—Ä–∏—Ñ",
                speakerClass: "arif",
                text: "–í –ø–∞—Ä–∫ –∑–æ–≤—ë–º! –í–µ—á–µ—Ä–æ–º, –ø–æ—Å–ª–µ –ø–∞—Ä. –í—ã —Å –ù–∞—Ä–≥–∏–∑–æ–π –ø–æ–π–¥—ë—Ç–µ?",
                background: "bg-bus-stop",
                characters: ["nika", "arif"]
            },
            {
                type: "dialog",
                speaker: "–ù–∏–∫–∞",
                speakerClass: "nika",
                text: "–ö–æ–Ω–µ—á–Ω–æ! –ù–∞—Ä–≥–∏–∑–∞! –ù–∞—Å –≤ –ø–∞—Ä–∫ –∑–æ–≤—É—Ç!",
                background: "bg-bus-stop",
                characters: ["nika", "nargiza"]
            },
            {
                type: "dialog",
                speaker: "–ù–∞—Ä–≥–∏–∑–∞",
                speakerClass: "nargiza",
                text: "–í –ø–∞—Ä–∫? –°–µ–≥–æ–¥–Ω—è? –£ –º–µ–Ω—è –≤–æ–æ–±—â–µ-—Ç–æ –∞–Ω–∞—Ç–æ–º–∏—è...",
                background: "bg-bus-stop",
                characters: ["nika", "nargiza"]
            },
            {
                type: "dialog",
                speaker: "–ù–∏–∫–∞",
                speakerClass: "nika",
                text: "–î–∞ –ª–∞–¥–Ω–æ —Ç–µ–±–µ! –û–¥–∏–Ω –≤–µ—á–µ—Ä! –ö–æ–≥–¥–∞ —Ç—ã –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞–∑ –æ—Ç–¥—ã—Ö–∞–ª–∞?",
                background: "bg-bus-stop",
                characters: ["nika", "nargiza"]
            },
            {
                type: "choice",
                question: "–ü–æ–¥–¥–µ—Ä–∂–∞—Ç—å –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ?",
                choices: [
                    { 
                        text: "\"–ù–∞—Ä–≥–∏–∑–∞, –ø–æ–π–¥—ë–º! –û—Ç–¥—ã—Ö —Ç–æ–∂–µ –≤–∞–∂–µ–Ω.\"", 
                        next: 60, 
                        affectionNargiza: 10,
                        affectionNika: 5
                    },
                    { 
                        text: "\"–ù–∏–∫–∞ –ø—Ä–∞–≤–∞! –ë—É–¥–µ—Ç –≤–µ—Å–µ–ª–æ!\"", 
                        next: 63, 
                        affectionNargiza: 5,
                        affectionNika: 10,
                        nikaChoice: true
                    },
                    { 
                        text: "\"–ï—Å–ª–∏ –ù–∞—Ä–≥–∏–∑–∞ –∑–∞–Ω—è—Ç–∞, –ø–æ–Ω–∏–º–∞—é...\"", 
                        next: 66, 
                        affectionNargiza: -5,
                        affectionNika: -5
                    }
                ]
            },
            // Convince Nargiza
            {
                type: "dialog",
                speaker: "–ù–∞—Ä–≥–∏–∑–∞",
                speakerClass: "nargiza",
                text: "–ù—É... –ï—Å–ª–∏ –≤—ã –≤—Å–µ –∏–¥—ë—Ç–µ... –õ–∞–¥–Ω–æ, —É–≥–æ–≤–æ—Ä–∏–ª–∏!",
                background: "bg-bus-stop",
                characters: ["nargiza", "nika"]
            },
            {
                type: "dialog",
                speaker: "–ù–∏–∫–∞",
                speakerClass: "nika",
                text: "–£—Ä–∞! –ë–∏–±–∞—Ä—ã—Å, —Ç—ã –≤–æ–ª—à–µ–±–Ω–∏–∫! –ù–∏–∫—Ç–æ –Ω–µ –º–æ–∂–µ—Ç –∑–∞—Å—Ç–∞–≤–∏—Ç—å –ù–∞—Ä–≥–∏–∑—É –æ—Ç–ª–æ–∂–∏—Ç—å —É—á—ë–±—É!",
                background: "bg-bus-stop",
                characters: ["nargiza", "nika"]
            },
            {
                type: "dialog",
                speaker: "–ù–∞—Ä–≥–∏–∑–∞",
                speakerClass: "nargiza",
                text: "–ü—Ä–æ—Å—Ç–æ... –∏–Ω–æ–≥–¥–∞ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –Ω—É–∂–µ–Ω –ø–µ—Ä–µ—Ä—ã–≤...",
                background: "bg-bus-stop",
                characters: ["nargiza", "nika"],
                nextScene: 69
            },
            // Support Nika
            {
                type: "dialog",
                speaker: "–ù–∏–∫–∞",
                speakerClass: "nika",
                text: "–í–æ—Ç –≤–∏–¥–∏—à—å, –ù–∞—Ä–≥–∏–∑–∞! –î–∞–∂–µ –ë–∏–±–∞—Ä—ã—Å –≥–æ–≤–æ—Ä–∏—Ç! –î–≤–∞ –ø—Ä–æ—Ç–∏–≤ –æ–¥–Ω–æ–≥–æ!",
                background: "bg-bus-stop",
                characters: ["nargiza", "nika"]
            },
            {
                type: "dialog",
                speaker: "–ù–∞—Ä–≥–∏–∑–∞",
                speakerClass: "nargiza",
                text: "–õ–∞–¥–Ω–æ-–ª–∞–¥–Ω–æ, –∏–¥—É! –ù–æ –µ—Å–ª–∏ –∑–∞–≤–∞–ª—é –∞–Ω–∞—Ç–æ–º–∏—é ‚Äî –≤—ã –≤–∏–Ω–æ–≤–∞—Ç—ã!",
                background: "bg-bus-stop",
                characters: ["nargiza", "nika"]
            },
            {
                type: "dialog",
                speaker: "–ù–∏–∫–∞",
                speakerClass: "nika",
                text: "–°–ø–∞—Å–∏–±–æ –∑–∞ –ø–æ–¥–¥–µ—Ä–∂–∫—É! –¢—ã –∫–ª—ë–≤—ã–π!",
                background: "bg-bus-stop",
                characters: ["nargiza", "nika"],
                nextScene: 69
            },
            // Passive
            {
                type: "dialog",
                speaker: "–ù–∞—Ä–≥–∏–∑–∞",
                speakerClass: "nargiza",
                text: "–í–æ—Ç –≤–∏–¥–∏—à—å, –ù–∏–∫–∞. –ß–µ–ª–æ–≤–µ–∫ –ø–æ–Ω–∏–º–∞–µ—Ç, —á—Ç–æ —É—á—ë–±–∞ –≤–∞–∂–Ω–µ–µ.",
                background: "bg-bus-stop",
                characters: ["nargiza", "nika"]
            },
            {
                type: "dialog",
                speaker: "–ù–∏–∫–∞",
                speakerClass: "nika",
                text: "–í—ã –æ–±–∞ —Å–∫—É—á–Ω—ã–µ! –õ–∞–¥–Ω–æ, —Ç–æ–≥–¥–∞ —Ç–æ–ª—å–∫–æ –º—ã —Å –ê—Ä–∏—Ñ–æ–º –ø–æ–≤–µ—Å–µ–ª–∏–º—Å—è!",
                background: "bg-bus-stop",
                characters: ["nargiza", "nika"]
            },
            {
                type: "dialog",
                speaker: "",
                text: "–í –∏—Ç–æ–≥–µ –≤—Å–µ –≤—Å—ë —Ä–∞–≤–Ω–æ –ø–æ—à–ª–∏. –ù–æ –æ—Å–∞–¥–æ–∫ –æ—Å—Ç–∞–ª—Å—è...",
                background: "bg-bus-stop",
                characters: [],
                nextScene: 69
            },
            // Park scene
            {
                type: "dialog",
                speaker: "",
                text: "–í–µ—á–µ—Ä. –ü–∞—Ä–∫ –≤ –°–∞—Ç–ø–∞–µ–≤–µ. –û—Å–µ–Ω–Ω–∏–µ –ª–∏—Å—Ç—å—è –ø–æ–¥ –Ω–æ–≥–∞–º–∏, –ø—Ä–æ—Ö–ª–∞–¥–Ω—ã–π –≤–æ–∑–¥—É—Ö...",
                background: "bg-park",
                characters: ["nargiza", "nika", "arif"]
            },
            {
                type: "dialog",
                speaker: "–ê—Ä–∏—Ñ",
                speakerClass: "arif",
                text: "–°–ª—É—à–∞–π—Ç–µ, —è —Ç–∞–º –ª–∞—Ä—ë–∫ —Å —Ö–æ—Ç-–¥–æ–≥–∞–º–∏ –≤–∏–¥–µ–ª! –ü–æ–π–¥—É –∫—É–ø–ª—é! –ù–∏–∫–∞, –ø–æ–º–æ–∂–µ—à—å –¥–æ–Ω–µ—Å—Ç–∏?",
                background: "bg-park",
                characters: ["nargiza", "nika", "arif"]
            },
            {
                type: "dialog",
                speaker: "–ù–∏–∫–∞",
                speakerClass: "nika",
                text: "–û, –∫–æ–Ω–µ—á–Ω–æ! –í—ã –ø–æ–∫–∞... –ø–æ–≥—É–ª—è–π—Ç–µ —Ç—É—Ç!",
                background: "bg-park",
                characters: ["nargiza"]
            },
            {
                type: "dialog",
                speaker: "–ù–∞—Ä–≥–∏–∑–∞",
                speakerClass: "nargiza",
                text: "–ö–∞–∂–µ—Ç—Å—è, –Ω–∞—Å —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ –æ—Å—Ç–∞–≤–∏–ª–∏ –≤–¥–≤–æ—ë–º...",
                background: "bg-park",
                characters: ["nargiza"]
            },
            {
                type: "dialog",
                speaker: "–ë–∏–±–∞—Ä—ã—Å",
                speakerClass: "bibarys",
                text: "–ü–æ—Ö–æ–∂–µ –Ω–∞ —Ç–æ... –ê—Ä–∏—Ñ —Ç–∞–∫–æ–π. –í–µ—á–Ω–æ —á—Ç–æ-—Ç–æ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç.",
                background: "bg-park",
                characters: ["nargiza"]
            },
            {
                type: "dialog",
                speaker: "–ù–∞—Ä–≥–∏–∑–∞",
                speakerClass: "nargiza",
                text: "–ù–∏–∫–∞ —Ç–æ–∂–µ. –û–Ω–∏ –ø–æ—Ö–æ–∂–∏ —á–µ–º-—Ç–æ. –ó–Ω–∞–µ—à—å, —è —Ä–∞–¥–∞, —á—Ç–æ —Å–æ–≥–ª–∞—Å–∏–ª–∞—Å—å –ø—Ä–∏–π—Ç–∏.",
                background: "bg-evening",
                characters: ["nargiza"]
            },
            {
                type: "choice",
                question: "–ú–æ–º–µ–Ω—Ç –¥–ª—è –æ—Ç–∫—Ä–æ–≤–µ–Ω–Ω–æ–≥–æ —Ä–∞–∑–≥–æ–≤–æ—Ä–∞...",
                choices: [
                    { 
                        text: "\"–Ø —Ç–æ–∂–µ —Ä–∞–¥. –ü—Ä–∏—è—Ç–Ω–æ —É–∑–Ω–∞—Ç—å —Ç–µ–±—è –ª—É—á—à–µ.\"", 
                        next: 77, 
                        affectionNargiza: 15,
                        affectionNika: 0
                    },
                    { 
                        text: "\"–ê –ù–∏–∫–∞ –¥–∞–≤–Ω–æ —Ç–∞–∫–∞—è... —ç–Ω–µ—Ä–≥–∏—á–Ω–∞—è?\"", 
                        next: 80, 
                        affectionNargiza: 5,
                        affectionNika: 10,
                        nikaChoice: true
                    },
                    { 
                        text: "\"–î–∞, –ø–æ–≥–æ–¥–∞ —Ö–æ—Ä–æ—à–∞—è...\" (—Å–º–µ–Ω–∏—Ç—å —Ç–µ–º—É)", 
                        next: 83, 
                        affectionNargiza: -5,
                        affectionNika: 0
                    }
                ]
            },
            // Focus on Nargiza
            {
                type: "dialog",
                speaker: "–ù–∞—Ä–≥–∏–∑–∞",
                speakerClass: "nargiza",
                text: "–¢—ã —Ç–æ–∂–µ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π. –ü—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç, –∫–æ—Ç–æ—Ä—ã–π —Å–ª—É—à–∞–µ—Ç –æ —Ö–∏—Ä—É—Ä–≥–∏–∏ –∏ –Ω–µ –∑–∞—Å—ã–ø–∞–µ—Ç.",
                background: "bg-evening",
                characters: ["nargiza"]
            },
            {
                type: "dialog",
                speaker: "–ë–∏–±–∞—Ä—ã—Å",
                speakerClass: "bibarys",
                text: "–ü–æ—Ç–æ–º—É —á—Ç–æ —Ç—ã —Ä–∞—Å—Å–∫–∞–∑—ã–≤–∞–µ—à—å —É–≤–ª–µ—á—ë–Ω–Ω–æ. –≠—Ç–æ –∑–∞—Ä–∞–∂–∞–µ—Ç.",
                background: "bg-evening",
                characters: ["nargiza"]
            },
            {
                type: "dialog",
                speaker: "–ù–∞—Ä–≥–∏–∑–∞",
                speakerClass: "nargiza",
                text: "–°–ø–∞—Å–∏–±–æ... –≠—Ç–æ –º–Ω–æ–≥–æ –∑–Ω–∞—á–∏—Ç.",
                background: "bg-evening",
                characters: ["nargiza"],
                nextScene: 86
            },
            // Ask about Nika
            {
                type: "dialog",
                speaker: "–ù–∞—Ä–≥–∏–∑–∞",
                speakerClass: "nargiza",
                text: "–ù–∏–∫–∞? –î–∞, —Å –¥–µ—Ç—Å—Ç–≤–∞ —Ç–∞–∫–∞—è! –°–æ–ª–Ω—ã—à–∫–æ –Ω–∞—à–µ. –û–Ω–∞ –Ω—Ä–∞–≤–∏—Ç—Å—è —Ç–µ–±–µ?",
                background: "bg-evening",
                characters: ["nargiza"]
            },
            {
                type: "dialog",
                speaker: "–ë–∏–±–∞—Ä—ã—Å",
                speakerClass: "bibarys",
                text: "–û–Ω–∞ –≤–µ—Å—ë–ª–∞—è... –ù–æ —è –ø—Ä–æ—Å—Ç–æ —Å–ø—Ä–æ—Å–∏–ª!",
                background: "bg-evening",
                characters: ["nargiza"]
            },
            {
                type: "dialog",
                speaker: "–ù–∞—Ä–≥–∏–∑–∞",
                speakerClass: "nargiza",
                text: "–ù—É-–Ω—É... –û–Ω–∞ —Ç–æ–∂–µ –æ —Ç–µ–±–µ —Å–ø—Ä–∞—à–∏–≤–∞–ª–∞, –∫—Å—Ç–∞—Ç–∏.",
                background: "bg-evening",
                characters: ["nargiza"],
                nextScene: 86
            },
            // Change topic
            {
                type: "dialog",
                speaker: "–ù–∞—Ä–≥–∏–∑–∞",
                speakerClass: "nargiza",
                text: "...–î–∞, –ø–æ–≥–æ–¥–∞...",
                background: "bg-evening",
                characters: ["nargiza"]
            },
            {
                type: "dialog",
                speaker: "",
                text: "–ü–æ–≤–∏—Å–ª–∞ –Ω–µ–ª–æ–≤–∫–∞—è –ø–∞—É–∑–∞. –ö–∞–∂–µ—Ç—Å—è, –æ–Ω–∞ —Ö–æ—Ç–µ–ª–∞ –ø–æ–≥–æ–≤–æ—Ä–∏—Ç—å –æ —á—ë–º-—Ç–æ –±–æ–ª–µ–µ –ª–∏—á–Ω–æ–º...",
                background: "bg-evening",
                characters: ["nargiza"]
            },
            {
                type: "dialog",
                speaker: "–ù–∞—Ä–≥–∏–∑–∞",
                speakerClass: "nargiza",
                text: "–ü–æ–π–¥—ë–º –∫ –æ—Å—Ç–∞–ª—å–Ω—ã–º?",
                background: "bg-evening",
                characters: ["nargiza"],
                nextScene: 86
            },
            // Nika and Arif return
            {
                type: "dialog",
                speaker: "–ù–∏–∫–∞",
                speakerClass: "nika",
                text: "–ú—ã –≤–µ—Ä–Ω—É–ª–∏—Å—å! –ö–∞–∫ –≤—ã —Ç—É—Ç –±–µ–∑ –Ω–∞—Å?",
                background: "bg-evening",
                characters: ["nargiza", "nika", "arif"]
            },
            {
                type: "dialog",
                speaker: "–ê—Ä–∏—Ñ",
                speakerClass: "arif",
                text: "–ù–∞–¥–µ—é—Å—å, —Ö–æ—Ä–æ—à–æ?",
                background: "bg-evening",
                characters: ["nargiza", "nika", "arif"]
            },
            {
                type: "dialog",
                speaker: "",
                text: "–ú—ã –ø—Ä–æ–≤–µ–ª–∏ –≤–µ—á–µ—Ä –≤—á–µ—Ç–≤–µ—Ä–æ–º. –°–º–µ—è–ª–∏—Å—å, —Ä–∞–∑–≥–æ–≤–∞—Ä–∏–≤–∞–ª–∏... –ù–æ —è –∑–∞–º–µ—Ç–∏–ª, —á—Ç–æ –∏ –ù–∞—Ä–≥–∏–∑–∞, –∏ –ù–∏–∫–∞ –∏–Ω–æ–≥–¥–∞ —É–∫—Ä–∞–¥–∫–æ–π —Å–º–æ—Ç—Ä–µ–ª–∏ –Ω–∞ –º–µ–Ω—è.",
                background: "bg-night",
                characters: ["nargiza", "nika"]
            },
            // ========== CHAPTER 3 ==========
            {
                type: "chapter",
                number: "–ì–ª–∞–≤–∞ 3",
                title: "–í—ã–±–æ—Ä",
                subtitle: "–ú–µ—Å—è—Ü —Å–ø—É—Å—Ç—è",
                background: "bg-computer-lab"
            },
            {
                type: "dialog",
                speaker: "",
                text: "–ü—Ä–æ—à—ë–ª –º–µ—Å—è—Ü. –ú—ã —Å—Ç–∞–ª–∏ –Ω–∞—Å—Ç–æ—è—â–∏–º–∏ –¥—Ä—É–∑—å—è–º–∏ ‚Äî –≤—á–µ—Ç–≤–µ—Ä–æ–º. –ù–æ –≤–Ω—É—Ç—Ä–∏ —è —á—É–≤—Å—Ç–≤–æ–≤–∞–ª, —á—Ç–æ –¥–æ–ª–∂–µ–Ω –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å—Å—è...",
                background: "bg-bus",
                characters: []
            },
            {
                type: "dialog",
                speaker: "–ê—Ä–∏—Ñ",
                speakerClass: "arif",
                text: "–ë—Ä–æ, —è –¥–æ–ª–∂–µ–Ω —Ç–µ–±–µ –∫–æ–µ-—á—Ç–æ —Å–∫–∞–∑–∞—Ç—å.",
                background: "bg-computer-lab",
                characters: ["arif"]
            },
            {
                type: "dialog",
                speaker: "–ë–∏–±–∞—Ä—ã—Å",
                speakerClass: "bibarys",
                text: "–ß—Ç–æ —Ç–∞–∫–æ–µ?",
                background: "bg-computer-lab",
                characters: ["arif"]
            },
            {
                type: "dialog",
                speaker: "–ê—Ä–∏—Ñ",
                speakerClass: "arif",
                text: "–û–±–µ –æ–Ω–∏... –ù–∞—Ä–≥–∏–∑–∞ –∏ –ù–∏–∫–∞... –û–Ω–∏ –æ–±–µ –∫ —Ç–µ–±–µ –Ω–µ—Ä–∞–≤–Ω–æ–¥—É—à–Ω—ã. –≠—Ç–æ –æ—á–µ–≤–∏–¥–Ω–æ.",
                background: "bg-computer-lab",
                characters: ["arif"]
            },
            {
                type: "dialog",
                speaker: "–ë–∏–±–∞—Ä—ã—Å",
                speakerClass: "bibarys",
                text: "–ß—Ç–æ?! –û—Ç–∫—É–¥–∞ —Ç—ã –∑–Ω–∞–µ—à—å?",
                background: "bg-computer-lab",
                characters: ["arif"]
            },
            {
                type: "dialog",
                speaker: "–ê—Ä–∏—Ñ",
                speakerClass: "arif",
                text: "–ë—Ä–æ, —è –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç, –Ω–æ –Ω–µ —Å–ª–µ–ø–æ–π! –ù–∞—Ä–≥–∏–∑–∞ —Å–º–æ—Ç—Ä–∏—Ç –Ω–∞ —Ç–µ–±—è —Ç–∞–∫, –±—É–¥—Ç–æ —Ç—ã –µ—ë –ø–∞—Ü–∏–µ–Ω—Ç, –∫–æ—Ç–æ—Ä–æ–≥–æ –æ–Ω–∞ —Ö–æ—á–µ—Ç —Å–ø–∞—Å—Ç–∏. –ê –ù–∏–∫–∞ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –∏—â–µ—Ç –ø–æ–≤–æ–¥—ã –¥–æ—Ç—Ä–æ–Ω—É—Ç—å—Å—è –¥–æ —Ç–µ–±—è.",
                background: "bg-computer-lab",
                characters: ["arif"]
            },
            {
                type: "dialog",
                speaker: "–ê—Ä–∏—Ñ",
                speakerClass: "arif",
                text: "–¢—ã –¥–æ–ª–∂–µ–Ω –≤—ã–±—Ä–∞—Ç—å. –ò–Ω–∞—á–µ –ø–æ—Ç–µ—Ä—è–µ—à—å –æ–±–µ–∏—Ö. –ò —Ä–∞–∑—Ä—É—à–∏—à—å –∏—Ö –¥—Ä—É–∂–±—É.",
                background: "bg-computer-lab",
                characters: ["arif"]
            },
            {
                type: "dialog",
                speaker: "–ë–∏–±–∞—Ä—ã—Å",
                speakerClass: "bibarys",
                text: "(–û–Ω –ø—Ä–∞–≤... –Ø –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —á–µ—Å—Ç–Ω—ã–º —Å —Å–æ–±–æ–π. –ö—Ç–æ –º–Ω–µ –±–ª–∏–∂–µ?)",
                background: "bg-computer-lab",
                characters: ["arif"]
            },
            {
                type: "choice",
                question: "–ö –∫–æ–º—É —è —á—É–≤—Å—Ç–≤—É—é –±–æ–ª—å—à–µ?",
                choices: [
                    { 
                        text: "üíó –ö –ù–∞—Ä–≥–∏–∑–µ ‚Äî –µ—ë —Å–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ –∏ –≥–ª—É–±–∏–Ω–∞ –ø—Ä–∏—Ç—è–≥–∏–≤–∞—é—Ç –º–µ–Ω—è", 
                        next: 100, 
                        affectionNargiza: 20,
                        affectionNika: -10,
                        flag: "route_nargiza"
                    },
                    { 
                        text: "üíú –ö –ù–∏–∫–µ ‚Äî –µ—ë —ç–Ω–µ—Ä–≥–∏—è –∏ —è—Ä–∫–æ—Å—Ç—å –¥–µ–ª–∞—é—Ç –º–µ–Ω—è —Å—á–∞—Å—Ç–ª–∏–≤—ã–º", 
                        next: 110, 
                        affectionNargiza: -10,
                        affectionNika: 20,
                        flag: "route_nika",
                        nikaChoice: true
                    },
                    { 
                        text: "–Ø –Ω–µ –≥–æ—Ç–æ–≤ –≤—ã–±–∏—Ä–∞—Ç—å. –ü—É—Å—Ç—å –≤—Å—ë –∏–¥—ë—Ç –∫–∞–∫ –∏–¥—ë—Ç.", 
                        next: 120, 
                        affectionNargiza: -15,
                        affectionNika: -15,
                        flag: "no_choice"
                    }
                ]
            },
            // ========== NARGIZA ROUTE ==========
            {
                type: "dialog",
                speaker: "–ë–∏–±–∞—Ä—ã—Å",
                speakerClass: "bibarys",
                text: "(–ù–∞—Ä–≥–∏–∑–∞... –Ø —Ö–æ—á—É –±—ã—Ç—å —Ä—è–¥–æ–º —Å –Ω–µ–π. –•–æ—á—É –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –µ—ë –º–µ—á—Ç—É. –•–æ—á—É –≤–∏–¥–µ—Ç—å –µ—ë —É–ª—ã–±–∫—É –∫–∞–∂–¥—ã–π –¥–µ–Ω—å.)",
                background: "bg-bus-stop",
                characters: []
            },
            {
                type: "dialog",
                speaker: "",
                text: "–°–ª–µ–¥—É—é—â–∏–º —É—Ç—Ä–æ–º –Ω–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ —è –ø–æ–¥–æ—à—ë–ª –∫ –ù–∞—Ä–≥–∏–∑–µ, –ø–æ–∫–∞ –ù–∏–∫–∞ –≥–æ–≤–æ—Ä–∏–ª–∞ –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É...",
                background: "bg-bus-stop",
                characters: ["nargiza"]
            },
            {
                type: "dialog",
                speaker: "–ë–∏–±–∞—Ä—ã—Å",
                speakerClass: "bibarys",
                text: "–ù–∞—Ä–≥–∏–∑–∞... –ú–æ–∂–µ–º –ø–æ–≥–æ–≤–æ—Ä–∏—Ç—å? –ù–∞–µ–¥–∏–Ω–µ?",
                background: "bg-bus-stop",
                characters: ["nargiza"]
            },
            {
                type: "dialog",
                speaker: "–ù–∞—Ä–≥–∏–∑–∞",
                speakerClass: "nargiza",
                text: "–ö–æ–Ω–µ—á–Ω–æ... –ß—Ç–æ-—Ç–æ —Å–ª—É—á–∏–ª–æ—Å—å?",
                background: "bg-bus-stop",
                characters: ["nargiza"]
            },
            {
                type: "dialog",
                speaker: "–ë–∏–±–∞—Ä—ã—Å",
                speakerClass: "bibarys",
                text: "–ù–µ—Ç, –ø—Ä–æ—Å—Ç–æ... –≠—Ç–∏ –º–µ—Å—è—Ü—ã, —á—Ç–æ –º—ã –µ–∑–¥–∏–º –≤–º–µ—Å—Ç–µ... –¢—ã —Å—Ç–∞–ª–∞ –¥–ª—è –º–µ–Ω—è –≤–∞–∂–Ω–æ–π.",
                background: "bg-evening",
                characters: ["nargiza"]
            },
            {
                type: "dialog",
                speaker: "–ù–∞—Ä–≥–∏–∑–∞",
                speakerClass: "nargiza",
                text: "–ë–∏–±–∞—Ä—ã—Å...",
                background: "bg-evening",
                characters: ["nargiza"]
            },
            {
                type: "dialog",
                speaker: "–ë–∏–±–∞—Ä—ã—Å",
                speakerClass: "bibarys",
                text: "–ù–∞—Ä–≥–∏–∑–∞, —Ç—ã –Ω—Ä–∞–≤–∏—à—å—Å—è –º–Ω–µ. –û—á–µ–Ω—å. –ù–µ –∫–∞–∫ –ø–æ–¥—Ä—É–≥–∞... –ë–æ–ª—å—à–µ.",
                background: "bg-evening",
                characters: ["nargiza"]
            },
            {
                type: "dialog",
                speaker: "–ù–∞—Ä–≥–∏–∑–∞",
                speakerClass: "nargiza",
                text: "–Ø... –Ø —Ç–æ–∂–µ... –¢—ã —Ç–æ–∂–µ –º–Ω–µ –Ω—Ä–∞–≤–∏—à—å—Å—è, –ë–∏–±–∞—Ä—ã—Å. –° —Ç–æ–≥–æ –ø–µ—Ä–≤–æ–≥–æ –¥–Ω—è –Ω–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ.",
                background: "bg-evening",
                characters: ["nargiza"],
                nextScene: "nargiza_ending_check"
            },
            // ========== NIKA ROUTE ==========
            {
                type: "dialog",
                speaker: "–ë–∏–±–∞—Ä—ã—Å",
                speakerClass: "bibarys",
                text: "(–ù–∏–∫–∞... –†—è–¥–æ–º —Å –Ω–µ–π —è —á—É–≤—Å—Ç–≤—É—é —Å–µ–±—è –∂–∏–≤—ã–º. –û–Ω–∞ –∑–∞—Å—Ç–∞–≤–ª—è–µ—Ç –º–µ–Ω—è —É–ª—ã–±–∞—Ç—å—Å—è –¥–∞–∂–µ –≤ —Å–∞–º—ã–µ —Ç—è–∂—ë–ª—ã–µ –¥–Ω–∏.)",
                background: "bg-bus-stop",
                characters: []
            },
            {
                type: "dialog",
                speaker: "",
                text: "–ü–æ—Å–ª–µ –ø–∞—Ä —è –ø–æ–¥–æ—à—ë–ª –∫ –ù–∏–∫–µ, –∫–æ–≥–¥–∞ –ù–∞—Ä–≥–∏–∑–∞ —É—à–ª–∞ –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫—É...",
                background: "bg-college",
                characters: ["nika"]
            },
            {
                type: "dialog",
                speaker: "–ë–∏–±–∞—Ä—ã—Å",
                speakerClass: "bibarys",
                text: "–ù–∏–∫–∞! –ü–æ–¥–æ–∂–¥–∏!",
                background: "bg-college",
                characters: ["nika"]
            },
            {
                type: "dialog",
                speaker: "–ù–∏–∫–∞",
                speakerClass: "nika",
                text: "–û, –ë–∏–±–∞—Ä—ã—Å! –ß—Ç–æ —Ç–∞–∫–æ–µ, –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç?",
                background: "bg-college",
                characters: ["nika"]
            },
            {
                type: "dialog",
                speaker: "–ë–∏–±–∞—Ä—ã—Å",
                speakerClass: "bibarys",
                text: "–ú–æ–∂–Ω–æ —Ç–µ–±—è –Ω–∞ –º–∏–Ω—É—Ç—É? –•–æ—á—É –∫–æ–µ-—á—Ç–æ —Å–∫–∞–∑–∞—Ç—å...",
                background: "bg-park",
                characters: ["nika"]
            },
            {
                type: "dialog",
                speaker: "–ù–∏–∫–∞",
                speakerClass: "nika",
                text: "–≠—Ç–æ... —Å–µ—Ä—å—ë–∑–Ω–æ?",
                background: "bg-park",
                characters: ["nika"]
            },
            {
                type: "dialog",
                speaker: "–ë–∏–±–∞—Ä—ã—Å",
                speakerClass: "bibarys",
                text: "–ù–∏–∫–∞, —Ä—è–¥–æ–º —Å —Ç–æ–±–æ–π —è –∑–∞–±—ã–≤–∞—é –æ–±–æ –≤—Å–µ—Ö –ø—Ä–æ–±–ª–µ–º–∞—Ö. –¢–≤–æ—è —É–ª—ã–±–∫–∞... –û–Ω–∞ –¥–µ–ª–∞–µ—Ç –º–æ–π –¥–µ–Ω—å –ª—É—á—à–µ. –¢—ã –Ω—Ä–∞–≤–∏—à—å—Å—è –º–Ω–µ.",
                background: "bg-evening",
                characters: ["nika"]
            },
            {
                type: "dialog",
                speaker: "–ù–∏–∫–∞",
                speakerClass: "nika",
                text: "–ë–∏–±–∞—Ä—ã—Å!! –Ø –¥—É–º–∞–ª–∞, —á—Ç–æ –Ω—Ä–∞–≤–ª—é—Å—å —Ç–æ–ª—å–∫–æ –∫–∞–∫ –ø–æ–¥—Ä—É–≥–∞! –¢—ã —Ç–æ–∂–µ –º–Ω–µ –Ω—Ä–∞–≤–∏—à—å—Å—è! –î–∞–≤–Ω–æ!",
                background: "bg-evening",
                characters: ["nika"],
                nextScene: "nika_ending_check"
            },
            // ========== NO CHOICE ROUTE ==========
            {
                type: "dialog",
                speaker: "–ë–∏–±–∞—Ä—ã—Å",
                speakerClass: "bibarys",
                text: "(–Ø –Ω–µ –º–æ–≥—É –≤—ã–±—Ä–∞—Ç—å... –ù–µ —Ö–æ—á—É –Ω–∏–∫–æ–≥–æ —Ä–∞–Ω–∏—Ç—å...)",
                background: "bg-bus-stop",
                characters: []
            },
            {
                type: "dialog",
                speaker: "",
                text: "–ü—Ä–æ—à–ª–æ –µ—â—ë –Ω–µ—Å–∫–æ–ª—å–∫–æ –Ω–µ–¥–µ–ª—å. –Ø –∏–∑–±–µ–≥–∞–ª –ª–∏—á–Ω—ã—Ö —Ä–∞–∑–≥–æ–≤–æ—Ä–æ–≤ —Å –æ–±–µ–∏–º–∏...",
                background: "bg-bus",
                characters: []
            },
            {
                type: "dialog",
                speaker: "–ù–∏–∫–∞",
                speakerClass: "nika",
                text: "–ë–∏–±–∞—Ä—ã—Å, —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç? –¢—ã –∫–∞–∫–æ–π-—Ç–æ –æ—Ç—Å—Ç—Ä–∞–Ω—ë–Ω–Ω—ã–π –ø–æ—Å–ª–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è.",
                background: "bg-winter",
                characters: ["nika"]
            },
            {
                type: "dialog",
                speaker: "–ù–∞—Ä–≥–∏–∑–∞",
                speakerClass: "nargiza",
                text: "–ù–∏–∫–∞ –ø—Ä–∞–≤–∞... –ú—ã —Å–¥–µ–ª–∞–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ç–∞–∫?",
                background: "bg-winter",
                characters: ["nargiza", "nika"]
            },
            {
                type: "dialog",
                speaker: "–ë–∏–±–∞—Ä—ã—Å",
                speakerClass: "bibarys",
                text: "–ù–µ—Ç, —è –ø—Ä–æ—Å—Ç–æ... –ú–Ω–µ –Ω—É–∂–Ω–æ –≤—Ä–µ–º—è...",
                background: "bg-winter",
                characters: ["nargiza", "nika"]
            },
            {
                type: "dialog",
                speaker: "–ù–∏–∫–∞",
                speakerClass: "nika",
                text: "–ó–Ω–∞–µ—à—å —á—Ç–æ? –ú—ã —É—Å—Ç–∞–ª–∏ –∂–¥–∞—Ç—å. –û–±–µ.",
                background: "bg-winter",
                characters: ["nargiza", "nika"]
            },
            {
                type: "dialog",
                speaker: "–ù–∞—Ä–≥–∏–∑–∞",
                speakerClass: "nargiza",
                text: "–ù–∞–º –ª—É—á—à–µ –æ—Å—Ç–∞—Ç—å—Å—è –ø—Ä–æ—Å—Ç–æ... –∑–Ω–∞–∫–æ–º—ã–º–∏. –ü–æ–∫–∞, –ë–∏–±–∞—Ä—ã—Å.",
                background: "bg-winter",
                characters: [],
                nextScene: "bad_ending_alone"
            }
        ];

        // Endings
        const endings = {
            nargiza_good: {
                type: "good-nargiza",
                emoji: "üíó",
                title: "–•–û–†–û–®–ê–Ø –ö–û–ù–¶–û–í–ö–ê",
                subtitle: "¬´–°–µ—Ä–¥—Ü–µ —Ö–∏—Ä—É—Ä–≥–∞¬ª\n\n–ú—ã —Å –ù–∞—Ä–≥–∏–∑–æ–π –Ω–∞—á–∞–ª–∏ –≤—Å—Ç—Ä–µ—á–∞—Ç—å—Å—è. –ö–∞–∂–¥–æ–µ —É—Ç—Ä–æ –≤ –∞–≤—Ç–æ–±—É—Å–µ 101 —Ç–µ–ø–µ—Ä—å –Ω–∞–ø–æ–ª–Ω–µ–Ω–æ —Ç–µ–ø–ª–æ–º. –û–Ω–∞ –¥–µ—Ä–∂–∏—Ç –º–µ–Ω—è –∑–∞ —Ä—É–∫—É, —Ä–∞—Å—Å–∫–∞–∑—ã–≤–∞—è –æ —Å–≤–æ–µ–π –º–µ—á—Ç–µ —Å—Ç–∞—Ç—å —Ö–∏—Ä—É—Ä–≥–æ–º.\n\n–ù–∏–∫–∞ –±—ã–ª–∞ —Ä–∞–¥–∞ –∑–∞ –Ω–∞—Å. ¬´–Ø –∑–Ω–∞–ª–∞!¬ª ‚Äî —Å–∫–∞–∑–∞–ª–∞ –æ–Ω–∞, –æ–±–Ω–∏–º–∞—è –ø–æ–¥—Ä—É–≥—É.\n\n–Ø –ø–æ–º–æ–≥–∞—é –ù–∞—Ä–≥–∏–∑–µ —Å —Ñ–∏–∑–∏–∫–æ–π, –æ–Ω–∞ —É—á–∏—Ç –º–µ–Ω—è –±–∏–æ–ª–æ–≥–∏–∏. –ò–¥–µ–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å.\n\n–ù–∞—à–∞ –∏—Å—Ç–æ—Ä–∏—è —Ç–æ–ª—å–∫–æ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è...\n\nüíó –°–ø–∞—Å–∏–±–æ –∑–∞ –∏–≥—Ä—É! üíó"
            },
            nargiza_bad: {
                type: "bad",
                emoji: "üíî",
                title: "–ü–õ–û–•–ê–Ø –ö–û–ù–¶–û–í–ö–ê",
                subtitle: "¬´–£–ø—É—â–µ–Ω–Ω—ã–π —à–∞–Ω—Å¬ª\n\n–Ø –ø—ã—Ç–∞–ª—Å—è –ø—Ä–∏–∑–Ω–∞—Ç—å—Å—è –ù–∞—Ä–≥–∏–∑–µ, –Ω–æ –±—ã–ª —Å–ª–∏—à–∫–æ–º —Ö–æ–ª–æ–¥–µ–Ω –≤—Å—ë —ç—Ç–æ –≤—Ä–µ–º—è...\n\n¬´–ò–∑–≤–∏–Ω–∏, –ë–∏–±–∞—Ä—ã—Å... –Ø –¥—É–º–∞–ª–∞, —á—Ç–æ –Ω—Ä–∞–≤–ª—é—Å—å —Ç–µ–±–µ, –Ω–æ —Ç—ã –±—ã–ª —Ç–∞–∫–∏–º –æ—Ç—Å—Ç—Ä–∞–Ω—ë–Ω–Ω—ã–º. –Ø... —É–∂–µ –≤—Å—Ç—Ä–µ—á–∞—é—Å—å —Å –∫–µ–º-—Ç–æ –¥—Ä—É–≥–∏–º.¬ª\n\n–ê–≤—Ç–æ–±—É—Å 101 —Å—Ç–∞–ª –¥–ª—è –º–µ–Ω—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ–º –æ —Ç–æ–º, —á—Ç–æ —è —É–ø—É—Å—Ç–∏–ª.\n\nüíî –ö–æ–Ω–µ—Ü"
            },
            nika_good: {
                type: "good-nika",
                emoji: "üíú",
                title: "–•–û–†–û–®–ê–Ø –ö–û–ù–¶–û–í–ö–ê",
                subtitle: "¬´–Ø—Ä–∫–æ–µ —Å–æ–ª–Ω—Ü–µ¬ª\n\n–ú—ã —Å –ù–∏–∫–æ–π –≤–º–µ—Å—Ç–µ! –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –Ω–∞–ø–æ–ª–Ω–µ–Ω —Å–º–µ—Ö–æ–º –∏ —Ä–∞–¥–æ—Å—Ç—å—é. –û–Ω–∞ —Ç–∞—â–∏—Ç –º–µ–Ω—è –Ω–∞ –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏—è, —è –ø–æ–∫–∞–∑—ã–≤–∞—é –µ–π –º–∏—Ä –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è.\n\n–ù–∞—Ä–≥–∏–∑–∞ —Å–Ω–∞—á–∞–ª–∞ –±—ã–ª–∞ —É–¥–∏–≤–ª–µ–Ω–∞, –Ω–æ –ø–æ—Ç–æ–º —É–ª—ã–±–Ω—É–ª–∞—Å—å: ¬´–ë–µ—Ä–µ–≥–∏ –µ—ë. –û–Ω–∞ –æ—Å–æ–±–µ–Ω–Ω–∞—è.¬ª\n\n–ù–∏–∫–∞ —Ä–∞—Å–∫—Ä–∞—Å–∏–ª–∞ –º–æ—é –∂–∏–∑–Ω—å —è—Ä–∫–∏–º–∏ –∫—Ä–∞—Å–∫–∞–º–∏. –ò —è –Ω–µ —Ö–æ—á—É –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å—Å—è –∫ —Å–µ—Ä–æ–º—É.\n\n–ù–∞—à–∞ –∏—Å—Ç–æ—Ä–∏—è —Ç–æ–ª—å–∫–æ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è...\n\nüíú –°–ø–∞—Å–∏–±–æ –∑–∞ –∏–≥—Ä—É! üíú"
            },
            nika_bad: {
                type: "bad",
                emoji: "üíî",
                title: "–ü–õ–û–•–ê–Ø –ö–û–ù–¶–û–í–ö–ê",
                subtitle: "¬´–ü–æ–≥–∞—Å—à–∞—è –∏—Å–∫—Ä–∞¬ª\n\n–ù–∏–∫–∞... –Ø —Å–ª–∏—à–∫–æ–º –¥–æ–ª–≥–æ –º–æ–ª—á–∞–ª. –°–ª–∏—à–∫–æ–º –¥–æ–ª–≥–æ –Ω–µ –¥–∞–≤–∞–ª –ø–æ–Ω—è—Ç—å, —á—Ç–æ —á—É–≤—Å—Ç–≤—É—é.\n\n¬´–ë–∏–±–∞—Ä—ã—Å, —è —É—Å—Ç–∞–ª–∞ –∂–¥–∞—Ç—å –∑–Ω–∞–∫–æ–≤ –æ—Ç —Ç–µ–±—è. –¢—ã –∫–ª–∞—Å—Å–Ω—ã–π, –Ω–æ... –Ø –Ω–∞—à–ª–∞ –∫–æ–≥–æ-—Ç–æ, –∫—Ç–æ –Ω–µ –±–æ–∏—Ç—Å—è –ø–æ–∫–∞–∑–∞—Ç—å —Å–≤–æ–∏ —á—É–≤—Å—Ç–≤–∞.¬ª\n\n–ï—ë —É–ª—ã–±–∫–∞ –±–æ–ª—å—à–µ –Ω–µ –¥–ª—è –º–µ–Ω—è.\n\nüíî –ö–æ–Ω–µ—Ü"
            },
            bad_alone: {
                type: "bad",
                emoji: "üòî",
                title: "–ü–õ–û–•–ê–Ø –ö–û–ù–¶–û–í–ö–ê",
                subtitle: "¬´–ê–≤—Ç–æ–±—É—Å –∏–¥—ë—Ç –¥–∞–ª—å—à–µ¬ª\n\n–Ø –ø–æ—Ç–µ—Ä—è–ª –∏—Ö –æ–±–µ–∏—Ö. –ù–∞—Ä–≥–∏–∑—É –∏ –ù–∏–∫—É. –î–∞–∂–µ –ê—Ä–∏—Ñ —Å–∫–∞–∑–∞–ª, —á—Ç–æ —è —Å–∞–º –≤–∏–Ω–æ–≤–∞—Ç.\n\n¬´–ë—Ä–æ, –Ω–µ–ª—å–∑—è —Ç–∞–∫ ‚Äî —Å–∏–¥–µ—Ç—å –Ω–∞ –¥–≤—É—Ö —Å—Ç—É–ª—å—è—Ö –∏ –±–æ—è—Ç—å—Å—è —É–ø–∞—Å—Ç—å. –í –∏—Ç–æ–≥–µ —É–ø–∞–ª –º–µ–∂–¥—É –Ω–∏–º–∏.¬ª\n\n–¢–µ–ø–µ—Ä—å —è –µ–∑–∂—É –Ω–∞ 101-–º –∞–≤—Ç–æ–±—É—Å–µ –æ–¥–∏–Ω. –ò–Ω–æ–≥–¥–∞ –≤–∏–∂—É –∏—Ö ‚Äî —Å—á–∞—Å—Ç–ª–∏–≤—ã—Ö, —Å –¥—Ä—É–≥–∏–º–∏ –ª—é–¥—å–º–∏.\n\n–ú–æ–∂–µ—Ç, –≤ —Å–ª–µ–¥—É—é—â–∏–π —Ä–∞–∑ –±—É–¥—É —Å–º–µ–ª–µ–µ...\n\nüíî –ö–æ–Ω–µ—Ü"
            }
        };

        // =============================================
        // PLATFORM SELECTION
        // =============================================
        function selectPlatform(platform) {
            gameState.platform = platform;
            if (platform === 'mobile') {
                document.body.classList.add('mobile-mode');
            }
            document.getElementById('platform-select').style.display = 'none';
            document.getElementById('game-container').style.display = 'block';
            startGame();
        }

        // =============================================
        // START GAME
        // =============================================
        function startGame() {
            gameState.currentScene = 0;
            gameState.affectionNargiza = 30;
            gameState.affectionNika = 20;
            gameState.flags = {};
            gameState.route = null;
            gameState.textComplete = true;
            showScene();
        }

        // =============================================
        // SHOW SCENE
        // =============================================
        function showScene() {
            const scene = story[gameState.currentScene];
            if (!scene) {
                checkEnding();
                return;
            }

            if (scene.type === "chapter") {
                showChapterTitle(scene);
            } else if (scene.type === "dialog") {
                showDialog(scene);
            } else if (scene.type === "choice") {
                showChoices(scene);
            }
        }

        // =============================================
        // CHAPTER TITLE - –ò–°–ü–†–ê–í–õ–ï–ù–û –ò –£–õ–£–ß–®–ï–ù–û!
        // =============================================
        function showChapterTitle(scene) {
            const overlay = document.getElementById('chapter-overlay');
            const chapterNumber = document.getElementById('chapter-number');
            const chapterMain = document.getElementById('chapter-main-title');
            const chapterSub = document.getElementById('chapter-subtitle');
            const bg = document.getElementById('background');
            
            // –°–∫—Ä—ã–≤–∞–µ–º –¥–∏–∞–ª–æ–≥
            document.getElementById('dialog-box').style.display = 'none';
            document.getElementById('character-display').innerHTML = '';
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–æ–Ω
            bg.className = 'background ' + scene.background;
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—Å—Ç
            chapterNumber.textContent = scene.number || '';
            chapterMain.textContent = scene.title;
            chapterSub.textContent = scene.subtitle || '';
            
            // –î–æ–±–∞–≤–ª—è–µ–º sparkles
            addSparkles(overlay);
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º overlay
            overlay.style.display = 'flex';
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é —á–µ—Ä–µ–∑ –Ω–µ–±–æ–ª—å—à—É—é –∑–∞–¥–µ—Ä–∂–∫—É
            setTimeout(() => {
                overlay.classList.add('active');
            }, 50);
            
            // –°–∫—Ä—ã–≤–∞–µ–º —á–µ—Ä–µ–∑ 3.5 —Å–µ–∫—É–Ω–¥—ã
            setTimeout(() => {
                overlay.classList.remove('active');
                
                setTimeout(() => {
                    overlay.style.display = 'none';
                    // –£–¥–∞–ª—è–µ–º sparkles
                    overlay.querySelectorAll('.chapter-sparkle').forEach(s => s.remove());
                    
                    document.getElementById('dialog-box').style.display = 'block';
                    gameState.currentScene++;
                    showScene();
                }, 600);
            }, 3500);
        }

        // –î–æ–±–∞–≤–ª—è–µ–º –±–ª–µ—Å—Ç–∫–∏
        function addSparkles(container) {
            for (let i = 0; i < 20; i++) {
                const sparkle = document.createElement('div');
                sparkle.className = 'chapter-sparkle';
                sparkle.style.left = Math.random() * 100 + '%';
                sparkle.style.top = Math.random() * 100 + '%';
                sparkle.style.animationDelay = Math.random() * 2 + 's';
                container.appendChild(sparkle);
            }
        }

        // =============================================
        // SHOW DIALOG - –ò–°–ü–†–ê–í–õ–ï–ù TYPEWRITER!
        // =============================================
        function showDialog(scene) {
            const bg = document.getElementById('background');
            const speakerName = document.getElementById('speaker-name');
            const dialogText = document.getElementById('dialog-text');
            const choicesContainer = document.getElementById('choices-container');
            const continueHint = document.getElementById('continue-hint');
            
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—ã–±–æ—Ä—ã
            choicesContainer.style.display = 'none';
            continueHint.style.display = 'block';
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–æ–Ω
            if (scene.background) {
                bg.className = 'background ' + scene.background;
            }
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–º—è –≥–æ–≤–æ—Ä—è—â–µ–≥–æ
            speakerName.textContent = scene.speaker || '–†–∞—Å—Å–∫–∞–∑—á–∏–∫';
            speakerName.className = scene.speakerClass || '';
            
            // –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô TYPEWRITER
            gameState.textComplete = false;
            gameState.currentText = scene.text;
            gameState.currentTextIndex = 0;
            dialogText.textContent = '';
            
            // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π –∏–Ω—Ç–µ—Ä–≤–∞–ª
            if (typewriterInterval) {
                clearInterval(typewriterInterval);
            }
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –Ω–æ–≤—ã–π typewriter
            typewriterInterval = setInterval(() => {
                if (gameState.currentTextIndex < gameState.currentText.length) {
                    dialogText.textContent += gameState.currentText[gameState.currentTextIndex];
                    gameState.currentTextIndex++;
                } else {
                    clearInterval(typewriterInterval);
                    typewriterInterval = null;
                    gameState.textComplete = true;
                }
            }, 25);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π
            updateCharacters(scene.characters || [], scene.speaker);
            updateAffection();
        }

        // =============================================
        // UPDATE CHARACTERS
        // =============================================
        function updateCharacters(charList, speaker) {
            const display = document.getElementById('character-display');
            display.innerHTML = '';
            
            charList.forEach(charId => {
                const char = characters[charId];
                if (!char) return;
                
                const charDiv = document.createElement('div');
                charDiv.className = 'character fade-in';
                if (char.name === speaker) {
                    charDiv.classList.add('speaking');
                }
                
                charDiv.innerHTML = `
                    <div class="character-sprite">
                        <div class="character-avatar ${char.colorClass}">${char.emoji}</div>
                        <div class="character-name-tag">${char.name}</div>
                        <div class="character-role">${char.role}</div>
                    </div>
                `;
                display.appendChild(charDiv);
            });
        }

        // =============================================
        // SHOW CHOICES
        // =============================================
        function showChoices(scene) {
            const choicesContainer = document.getElementById('choices-container');
            const continueHint = document.getElementById('continue-hint');
            const dialogText = document.getElementById('dialog-text');
            const speakerName = document.getElementById('speaker-name');
            
            speakerName.textContent = '‚ùì –í—ã–±–æ—Ä';
            speakerName.className = '';
            dialogText.textContent = scene.question;
            
            continueHint.style.display = 'none';
            choicesContainer.style.display = 'flex';
            choicesContainer.innerHTML = '';
            
            scene.choices.forEach((choice, index) => {
                const btn = document.createElement('button');
                btn.className = 'choice-btn slide-up';
                if (choice.nikaChoice) {
                    btn.classList.add('nika-choice');
                }
                btn.style.animationDelay = (index * 0.1) + 's';
                btn.textContent = choice.text;
                btn.onclick = () => makeChoice(choice);
                choicesContainer.appendChild(btn);
            });
        }

        // =============================================
        // MAKE CHOICE
        // =============================================
        function makeChoice(choice) {
            if (choice.affectionNargiza) {
                gameState.affectionNargiza += choice.affectionNargiza;
            }
            if (choice.affectionNika) {
                gameState.affectionNika += choice.affectionNika;
            }
            
            if (choice.flag) {
                gameState.flags[choice.flag] = true;
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–µ—Ä–¥–µ—á–∫–∏ –¥–ª—è –ø–æ–∑–∏—Ç–∏–≤–Ω—ã—Ö –≤—ã–±–æ—Ä–æ–≤
            if ((choice.affectionNargiza && choice.affectionNargiza > 0) || 
                (choice.affectionNika && choice.affectionNika > 0)) {
                showHearts(choice.nikaChoice ? 'üíú' : 'üíó');
            }
            
            document.getElementById('choices-container').style.display = 'none';
            document.getElementById('continue-hint').style.display = 'block';
            
            gameState.currentScene = choice.next;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–µ—Ä–µ—Ö–æ–¥ –∫ –∫–æ–Ω—Ü–æ–≤–∫–µ
            if (typeof choice.next === 'string') {
                handleEndingJump(choice.next);
                return;
            }
            
            showScene();
            updateAffection();
        }

        // =============================================
        // HANDLE ENDING JUMP
        // =============================================
        function handleEndingJump(jumpTo) {
            if (jumpTo === 'nargiza_ending_check') {
                if (gameState.affectionNargiza >= 60) {
                    showEnding('nargiza_good');
                } else {
                    showEnding('nargiza_bad');
                }
            } else if (jumpTo === 'nika_ending_check') {
                if (gameState.affectionNika >= 60) {
                    showEnding('nika_good');
                } else {
                    showEnding('nika_bad');
                }
            } else if (jumpTo === 'bad_ending_alone') {
                showEnding('bad_alone');
            }
        }

        // =============================================
        // SHOW HEARTS
        // =============================================
        function showHearts(emoji) {
            for (let i = 0; i < 6; i++) {
                setTimeout(() => {
                    const heart = document.createElement('div');
                    heart.className = 'heart-float';
                    heart.textContent = emoji;
                    heart.style.left = (Math.random() * 80 + 10) + '%';
                    heart.style.top = (50 + Math.random() * 20) + '%';
                    document.body.appendChild(heart);
                    
                    setTimeout(() => heart.remove(), 2000);
                }, i * 100);
            }
        }

        // =============================================
        // ADVANCE DIALOG - –ò–°–ü–†–ê–í–õ–ï–ù–û!
        // =============================================
        function advanceDialog() {
            const scene = story[gameState.currentScene];
            if (!scene || scene.type === "choice" || scene.type === "chapter") return;
            
            // –ï—Å–ª–∏ —Ç–µ–∫—Å—Ç –µ—â—ë –ø–µ—á–∞—Ç–∞–µ—Ç—Å—è - –ø–æ–∫–∞–∑–∞—Ç—å –≤–µ—Å—å —Ç–µ–∫—Å—Ç —Å—Ä–∞–∑—É
            if (!gameState.textComplete) {
                if (typewriterInterval) {
                    clearInterval(typewriterInterval);
                    typewriterInterval = null;
                }
                document.getElementById('dialog-text').textContent = gameState.currentText;
                gameState.textComplete = true;
                return;
            }
            
            // –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–π —Å—Ü–µ–Ω–µ
            if (scene.nextScene) {
                if (typeof scene.nextScene === 'string') {
                    handleEndingJump(scene.nextScene);
                    return;
                }
                gameState.currentScene = scene.nextScene;
            } else {
                gameState.currentScene++;
            }
            
            showScene();
        }

        // =============================================
        // UPDATE AFFECTION
        // =============================================
        function updateAffection() {
            const fillNargiza = document.getElementById('affection-fill-nargiza');
            let percNargiza = Math.max(0, Math.min(100, gameState.affectionNargiza));
            fillNargiza.style.width = percNargiza + '%';
            
            const fillNika = document.getElementById('affection-fill-nika');
            let percNika = Math.max(0, Math.min(100, gameState.affectionNika));
            fillNika.style.width = percNika + '%';
        }

        // =============================================
        // CHECK ENDING
        // =============================================
        function checkEnding() {
            if (gameState.flags.route_nargiza) {
                if (gameState.affectionNargiza >= 60) {
                    showEnding('nargiza_good');
                } else {
                    showEnding('nargiza_bad');
                }
            } else if (gameState.flags.route_nika) {
                if (gameState.affectionNika >= 60) {
                    showEnding('nika_good');
                } else {
                    showEnding('nika_bad');
                }
            } else if (gameState.flags.no_choice) {
                showEnding('bad_alone');
            } else {
                if (gameState.affectionNargiza > gameState.affectionNika) {
                    showEnding(gameState.affectionNargiza >= 50 ? 'nargiza_good' : 'nargiza_bad');
                } else if (gameState.affectionNika > gameState.affectionNargiza) {
                    showEnding(gameState.affectionNika >= 50 ? 'nika_good' : 'nika_bad');
                } else {
                    showEnding('bad_alone');
                }
            }
        }

        // =============================================
        // SHOW ENDING
        // =============================================
        function showEnding(endingKey) {
            const ending = endings[endingKey];
            const endingScreen = document.getElementById('ending-screen');
            
            let bgClass = 'ending-bad';
            if (ending.type === 'good-nargiza') bgClass = 'ending-good-nargiza';
            else if (ending.type === 'good-nika') bgClass = 'ending-good-nika';
            
            endingScreen.className = bgClass;
            endingScreen.style.display = 'flex';
            
            document.getElementById('ending-emoji').textContent = ending.emoji;
            document.getElementById('ending-title').textContent = ending.title;
            document.getElementById('ending-subtitle').textContent = ending.subtitle;
        }

        // =============================================
        // MENU FUNCTIONS
        // =============================================
        function toggleMenu() {
            const menu = document.getElementById('menu-overlay');
            menu.style.display = menu.style.display === 'flex' ? 'none' : 'flex';
        }

        function saveGame() {
            localStorage.setItem('serdceSatpaeva21', JSON.stringify(gameState));
            showNotification('üíæ –ò–≥—Ä–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!');
        }

        function loadGame() {
            const saved = localStorage.getItem('serdceSatpaeva21');
            if (saved) {
                gameState = JSON.parse(saved);
                toggleMenu();
                showScene();
                updateAffection();
                showNotification('üìÇ –ò–≥—Ä–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞!');
            } else {
                showNotification('‚ùå –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ!');
            }
        }

        function showNotification(text) {
            const notif = document.createElement('div');
            notif.className = 'notification';
            notif.textContent = text;
            document.body.appendChild(notif);
            setTimeout(() => notif.remove(), 2000);
        }

        function restartGame() {
            document.getElementById('ending-screen').style.display = 'none';
            document.getElementById('menu-overlay').style.display = 'none';
            document.getElementById('game-container').style.display = 'block';
            startGame();
        }

        function toggleAuto() {
            gameState.autoMode = !gameState.autoMode;
            document.getElementById('auto-btn').style.background = 
                gameState.autoMode ? 'rgba(255, 107, 157, 0.7)' : 'rgba(0, 0, 0, 0.7)';
            
            if (gameState.autoMode) {
                autoAdvance();
            }
        }

        function autoAdvance() {
            if (gameState.autoMode && story[gameState.currentScene]?.type !== 'choice') {
                setTimeout(() => {
                    if (gameState.autoMode) {
                        advanceDialog();
                        autoAdvance();
                    }
                }, 3500);
            }
        }

        // =============================================
        // KEYBOARD CONTROLS
        // =============================================
        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space' || e.code === 'Enter') {
                e.preventDefault();
                advanceDialog();
            } else if (e.code === 'Escape') {
                toggleMenu();
            }
        });
    </script>
</body>
</html>
